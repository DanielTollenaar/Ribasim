<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Bach</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Bach</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./equations.html">Water balance</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./modflow.html">Modflow Coupling</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./demo.html">Bach Functionality Demonstration</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./coupling-demo.html">Bach-Modflow Demonstration</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./developer.html">Dev docs</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#status" id="toc-status" class="nav-link active" data-scroll-target="#status"><span class="toc-section-number">1</span>  Status</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="toc-section-number">2</span>  Introduction</a>
  <ul class="collapse">
  <li><a href="#water-balance-equations" id="toc-water-balance-equations" class="nav-link" data-scroll-target="#water-balance-equations"><span class="toc-section-number">2.1</span>  Water balance equations</a></li>
  <li><a href="#time" id="toc-time" class="nav-link" data-scroll-target="#time"><span class="toc-section-number">2.2</span>  Time</a></li>
  <li><a href="#sec-space" id="toc-sec-space" class="nav-link" data-scroll-target="#sec-space"><span class="toc-section-number">2.3</span>  Space</a></li>
  </ul></li>
  <li><a href="#usage" id="toc-usage" class="nav-link" data-scroll-target="#usage"><span class="toc-section-number">3</span>  Usage</a>
  <ul class="collapse">
  <li><a href="#installing-the-compiled-executable" id="toc-installing-the-compiled-executable" class="nav-link" data-scroll-target="#installing-the-compiled-executable"><span class="toc-section-number">3.1</span>  Installing the compiled executable</a></li>
  <li><a href="#installing-as-a-julia-package" id="toc-installing-as-a-julia-package" class="nav-link" data-scroll-target="#installing-as-a-julia-package"><span class="toc-section-number">3.2</span>  Installing as a Julia package</a></li>
  <li><a href="#input-and-output-files" id="toc-input-and-output-files" class="nav-link" data-scroll-target="#input-and-output-files"><span class="toc-section-number">3.3</span>  Input and output files</a>
  <ul class="collapse">
  <li><a href="#configuration-file" id="toc-configuration-file" class="nav-link" data-scroll-target="#configuration-file"><span class="toc-section-number">3.3.1</span>  Configuration file</a></li>
  <li><a href="#network" id="toc-network" class="nav-link" data-scroll-target="#network"><span class="toc-section-number">3.3.2</span>  Network</a></li>
  <li><a href="#arrow-files" id="toc-arrow-files" class="nav-link" data-scroll-target="#arrow-files"><span class="toc-section-number">3.3.3</span>  Arrow files</a></li>
  <li><a href="#state" id="toc-state" class="nav-link" data-scroll-target="#state"><span class="toc-section-number">3.3.4</span>  State</a></li>
  <li><a href="#static" id="toc-static" class="nav-link" data-scroll-target="#static"><span class="toc-section-number">3.3.5</span>  Static</a></li>
  <li><a href="#profile" id="toc-profile" class="nav-link" data-scroll-target="#profile"><span class="toc-section-number">3.3.6</span>  Profile</a></li>
  <li><a href="#forcing" id="toc-forcing" class="nav-link" data-scroll-target="#forcing"><span class="toc-section-number">3.3.7</span>  Forcing</a></li>
  <li><a href="#water-balance" id="toc-water-balance" class="nav-link" data-scroll-target="#water-balance"><span class="toc-section-number">3.3.8</span>  Water balance</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bach</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Bach is a water resources model, designed to be the replacement of the regional surface water modules Mozart and SIMRES in the Netherlands Hydrological Instrument (NHI). Bach is a work in progress, it is a prototype that demonstrates all essential functionalities. Further development of the prototype in a software release is planned in 2022 and 2023.</p>
<p>Bach is written in the <a href="https://julialang.org/">Julia programming language</a> and is built on top of the <a href="https://sciml.ai/">SciML: Open Source Software for Scientific Machine Learning</a> libraries, notably <a href="https://mtk.sciml.ai/stable/">ModelingToolkit.jl</a>.</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-bottom">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><a href="https://www.deltares.nl/"> <img alt="Deltares logo" src="https://user-images.githubusercontent.com/4471859/187672447-adb9cb11-16ca-488b-bef9-08e059fe6d55.svg" height="60"> </a></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><a href="https://nhi.nu/"> <img alt="NHI logo" src="https://user-images.githubusercontent.com/4471859/187672456-874b344a-9ad3-42b5-af6a-93517f7fbbe8.png" height="60"> </a></p>
</div>
</div>
</div>
<section id="status" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Status</h1>
<p>The initial focus is on being able to reproduce the Mozart regional surface water reservoir results. Each component is defined by a set of symbolic equations, and can be connected to each other. From this a simplified system of equations is generated automatically. We use solvers with adaptive time stepping from <a href="https://diffeq.sciml.ai/stable/">DifferentialEquations.jl</a> to get results.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://user-images.githubusercontent.com/4471859/179259333-070dfe18-8f43-4ac4-bb38-013b252e2e4b.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Example timeseries of a single basin, the Hupselse Beek, with the input and output fluxes on the top, and the storage volume (the state) below.</figcaption><p></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://user-images.githubusercontent.com/4471859/179259174-0caccd4a-c51b-449e-873c-17d48cfc8870.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Example bar plot of the daily waterbalance for the Hupselse Beek, comparing results of Mozart (left) and Bach (right).</figcaption><p></p>
</figure>
</div>
</section>
<section id="introduction" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Introduction</h1>
<section id="water-balance-equations" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="water-balance-equations"><span class="header-section-number">2.1</span> Water balance equations</h2>
<p>The water balance equation for a drainage basin <span class="citation" data-cites="enwiki:1099736933">(<a href="#ref-enwiki:1099736933" role="doc-biblioref">Wikipedia contributors 2022</a>)</span> can be defined a first-order ordinary differential equation (ODE), where the change of the storage <span class="math inline">\(S\)</span> over time is determined by the inflow fluxes minus the outflow fluxes.</p>
<p><span class="math display">\[
\frac{\mathrm{d}S}{\mathrm{d}t} = Q_{in} - Q_{out}
\]</span></p>
<p>We can split out the fluxes into separate terms, such as precipitation <span class="math inline">\(P\)</span>, evapotranspiration <span class="math inline">\(ET\)</span> and runoff <span class="math inline">\(R\)</span>. For now other fluxes are combined into <span class="math inline">\(Q_{rest}\)</span>. If define all fluxes entering our reservoir as positive, and those leaving the system to be negative, all fluxes can be summed up.</p>
<p><span class="math display">\[
\frac{\mathrm{d}S}{\mathrm{d}t} = R + P + ET + Q_{rest}
\]</span></p>
<p>Such a water balance ODE can be represented in ModelingToolkit.jl as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ModelingToolkit</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@variables</span> t <span class="fu">S</span>(t) <span class="fu">R</span>(t) <span class="fu">P</span>(t) <span class="fu">ET</span>(t) <span class="fu">Q_rest</span>(t)  <span class="co"># independent and dependent variables</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> <span class="fu">Differential</span>(t)       <span class="co"># define an operator for the differentiation w.r.t. time</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>sys <span class="op">=</span> <span class="fu">ODESystem</span>([<span class="fu">D</span>(S) <span class="op">~</span> R <span class="op">+</span> P <span class="op">+</span> ET <span class="op">+</span> Q_rest])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>On the last line, an <code>ODESystem</code> is created that consists of a single equation. Before we can solve this, we need to create an <code>ODEProblem</code>, that provides information about the timespan of the simulation, as well as the initial conditions.</p>
<p>Bach can be used as a Julia package running in a Julia session or as an application initialized via TOML configuration files. Both uses are demonstrated in the demonstrations.</p>
</section>
<section id="time" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="time"><span class="header-section-number">2.2</span> Time</h2>
<p>The water balance equation can be applied on many timescales; years, weeks, days or hours. Depending on the application and available data any of these can be the best choice. In Bach, we make use of DifferentialEquations.jl and can use any of its <a href="https://diffeq.sciml.ai/stable/solvers/ode_solve/">ODE solvers</a>. Many of these solvers make use of adaptive time stepping, which means the solver will decide how large the time steps can be depending on the state of the system.</p>
<p>The forcing, like precipitation, is generally provided as a time series. Bach is set up to support unevenly spaced timeseries. The solver will stop on timestamps where new forcing values are available, so they can be loaded as the new value.</p>
<p>Bach is essentially a continuous model, rather than daily or hourly. If you want to use hourly forcing, you only need to make sure that your forcing data contains hourly updates. The output frequency can be configured independently. To be able to write a closed water balance, we accumulate the fluxes. This way any variations in between timesteps are also included, and we can output in <code>m³</code> rather than <code>m³s⁻¹</code>.</p>
</section>
<section id="sec-space" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-space"><span class="header-section-number">2.3</span> Space</h2>
<p>The water balance equation can be applied on different spatial scales. Besides modelling a single lumped watershed, it allows you to divide the area into a network of connected representative elementary watersheds (REWs) <span class="citation" data-cites="REGGIANI1998367">(<a href="#ref-REGGIANI1998367" role="doc-biblioref">Reggiani, Sivapalan, and Majid Hassanizadeh 1998</a>)</span>. At this scale global water balance laws can be formulated by means of integration of point-scale conservation equations over control volumes. Such an approach makes Bach a semi-distributed model. In this document we typically use the term “basin” to refer to the REW. (In Mozart the spatial unit was called Local Surface Water (LSW)). Each basin has an associated polygon, and the set of basins is connected to each other as described by a graph, which we call the network. Below is a representation of both on the map.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://user-images.githubusercontent.com/4471859/185932183-62c305e6-bc14-4f3c-a74c-437f831c9145.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Mozart Local Surface Water polygons and their drainage.</figcaption><p></p>
</figure>
</div>
<p>The network is described as graph. Flow can be bi-directional, and the graph does not have to be acyclic.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<p>
</p><pre class="mermaid" data-tooltip-selector="#mermaid-tooltip-1">graph LR;
    A["basin A"] --- B["basin B"];
    A --- C["basin C"];
    B --- D["basin D"];
    C --- D;
</pre>
<div id="mermaid-tooltip-1" class="mermaidTooltip">

</div>
<p></p>
</div>
</div>
</div>
<p>Internally a directed graph is used. The direction is defined to be the positive flow direction, and is generally set in the dominant flow direction. The basins are the nodes of the network graph. Basin states and properties such storage volume, wetted area are associated with the nodes (A, B, C, D), as are most forcing data such as precipitation, evaporation, or water demand. Basin connection properties and interbasin flows are associated with the edges (the lines between A, B, C, and D) instead.</p>
<p>Multiple basins may exist within the same spatial polygon, representing different aspects of the surface water system (perennial ditches, ephemeral ditches, or even surface ponding). <a href="#fig-p">Figure&nbsp;1</a>, <a href="#fig-s">Figure&nbsp;2</a>, <a href="#fig-t">Figure&nbsp;3</a> show the 25.0 m rasterized primary, secondary, and tertiary surface waters as identified by BRT TOP10NL <span class="citation" data-cites="pdoktopnl">(<a href="#ref-pdoktopnl" role="doc-biblioref">PDOK 2022</a>)</span> in the Hupsel basin (as defined in the Mozart LSW’s). These systems may represented in multiple ways.</p>
<div id="fig-p" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://user-images.githubusercontent.com/13662783/187625163-d0a81bb6-7f55-4ad1-83e2-90ec1ee79740.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Hupsel: primary surface water.</figcaption><p></p>
</figure>
</div>
<div id="fig-s" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://user-images.githubusercontent.com/13662783/187625170-1acdfb41-7077-443f-b140-ae18cbf21e53.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Hupsel: secondary surface water.</figcaption><p></p>
</figure>
</div>
<div id="fig-t" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://user-images.githubusercontent.com/13662783/187625174-3eec28b5-ddbb-4870-94c3-d9e9a43f8eb4.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Hupsel: tertiary surface water.</figcaption><p></p>
</figure>
</div>
<p>As a single basin (A) containing all surface water, discharging to its downstream basin to the west (B):</p>
<div class="cell">
<div class="cell-output-display">
<div>
<p>
</p><pre class="mermaid" data-tooltip-selector="#mermaid-tooltip-2">graph LR;
    A["basin A"] --&gt; B["basin B"];
</pre>
<div id="mermaid-tooltip-2" class="mermaidTooltip">

</div>
<p></p>
</div>
</div>
</div>
<p>Such a system may be capable of representing discharge, but it cannot represent residence times or differences in solute concentrations: within a single basin, drop of water is mixed instantaneously. Instead, we may the group primary (P), secondary (S), and tertiary (T) surface waters. Then T may flow into S, S into P, and P discharges to the downstream basin (B.)</p>
<div class="cell">
<div class="cell-output-display">
<div>
<p>
</p><pre class="mermaid" data-tooltip-selector="#mermaid-tooltip-3">graph LR;
    T["basin T"] --&gt; S["basin S"];
    S --&gt; P["basin P"]; 
    P --&gt; B["basin B"];
</pre>
<div id="mermaid-tooltip-3" class="mermaidTooltip">

</div>
<p></p>
</div>
</div>
</div>
<p>As each (sub)basin has its own volume, low throughput (high volume, low discharge, long residence time) and high throughput (low volume, high discharge, short residence time) systems can be represented in a lumped manner; of course, more detail requires more parameters.</p>
</section>
</section>
<section id="usage" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Usage</h1>
<section id="installing-the-compiled-executable" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="installing-the-compiled-executable"><span class="header-section-number">3.1</span> Installing the compiled executable</h2>
<p>Binaries of <code>bach_cli</code> can be downloaded from <a href="https://github.com/visr/bach-artifacts/releases">bach-artifacts</a>, and are currently available for Windows only. Download and unpack the <code>.zip</code> file. It can be placed anywhere, however it is important that the contents of the zip file are kept together in a directory. The <code>bach_cli</code> executable is in the <code>bin</code> directory.</p>
<p>To check whether the installation was performed successfully, run <code>bach_cli</code> with no arguments in the command line will give the following message:</p>
<pre><code>Usage: bach_cli 'path/to/config.toml'</code></pre>
</section>
<section id="installing-as-a-julia-package" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="installing-as-a-julia-package"><span class="header-section-number">3.2</span> Installing as a Julia package</h2>
<p>Bach is a <a href="https://julialang.org/">Julia</a> package, that can be installed using Julia’s built in package manager, <code>Pkg</code>. For more information on how to use <code>Pkg</code>, see the <a href="https://pkgdocs.julialang.org/v1/getting-started/">Getting Started</a> page in its documentation.</p>
<p>Since Bach is not yet registered in the General registry, you have to install it using the full url. Note that here suggest <code>dev</code> to do a development install.</p>
<pre class="julia-repl"><code>pkg&gt; dev https://github.com/Deltares/Bach.jl</code></pre>
<p>This will clone the git repository, put it under your home directory in <code>.julia/dev/Bach</code>, and add the Bach package to your project environment. Note that to receive updates, you have to pull in the latest changes yourself using <code>git pull</code>.</p>
<p>Installation may take a while since Pkg is also installing and pre-compiling the dependencies of Bach.</p>
<p>Once it is done, you can go back the Julia REPL and try to load Bach:</p>
<pre class="julia-repl"><code>julia&gt; using Bach</code></pre>
<p>If you already have a simulation prepared, you can run it using:</p>
<pre class="julia-repl"><code>julia&gt; Bach.run("path/to/config.toml")</code></pre>
<p>Again, there will be considerable latency. For this reason, if you expect to run Bach a lot, we recommend to:</p>
<ul>
<li>Use <code>bach_cli</code> if you only need <code>Bach.run</code> and don’t need to do developments.</li>
<li>Adapt a workflow that keeps you session active; the first <code>Bach.run("model.toml")</code> will take considerably more time than the second one, since more code needs to be compiled.</li>
<li>Use a system image, explained in the <a href="#developer.qmd">developer documentation</a>, to reduce latency further</li>
</ul>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip: Visual Studio Code
</div>
</div>
<div class="callout-body-container callout-body">
<p>There is a section on editors and IDEs for Julia on <a href="https://julialang.org/" class="uri">https://julialang.org/</a>, scroll down to see it. We use and recommend Microsoft’s free and open source <a href="https://code.visualstudio.com/">Visual Studio Code</a>. When combined with the <a href="https://www.julia-vscode.org/">Julia extension</a> it provides a powerful and interactive development experience.</p>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip: Revise.jl
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you plan to make changes to the code of Bach, we recommend installing the <code>Revise.jl</code> package. This package allows you to modify code and use the changes without restarting Julia. Install it with <code>add Revise</code> from the Pkg REPL. Then create a file called <code>.julia/config/startup.jl</code>, and put <code>using Revise</code> there. This will load Revise every time you start a Julia session.</p>
</div>
</div>
</section>
<section id="input-and-output-files" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="input-and-output-files"><span class="header-section-number">3.3</span> Input and output files</h2>
<section id="configuration-file" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="configuration-file"><span class="header-section-number">3.3.1</span> Configuration file</h3>
<p>Bach has a single configuration file, which is written in the <a href="https://toml.io/">TOML</a> format. It contains settings, as well as paths to other input and output files.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start- and endtime of the simulation</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># can also be set to a date-time like 1979-05-27T07:32:00</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">starttime</span> <span class="op">=</span> <span class="bn">2019-01-01</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="dt">endtime</span> <span class="op">=</span> <span class="bn">2021-01-01</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># maintain target waterlevel in level controlled basins</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="dt">add_levelcontrol</span> <span class="op">=</span> <span class="cn">true</span>  <span class="co"># default is true</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># run a coupled Bach - Modflow simulation</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="dt">run_modflow</span> <span class="op">=</span> <span class="cn">false</span>  <span class="co"># default is false</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># all timesteps are in seconds</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># do water allocation for this time horizon</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="dt">update_timestep</span> <span class="op">=</span> <span class="fl">86400.0</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># save output at this interval</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="dt">output_timestep</span> <span class="op">=</span> <span class="fl">86400.0</span>  <span class="co"># default is 86400.0</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># save timesteps at this interval</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># note that this is internal, and is forwarded to the DiffEq solver options</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co"># https://diffeq.sciml.ai/stable/basics/common_solver_opts/#Output-Control</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="dt">saveat</span> <span class="op">=</span> <span class="fl">86400.0</span>  <span class="co"># default is to save every step</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># location IDs that will be included in the simulation</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># these location IDs are referenced in the input files below</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="dt">lsw_ids</span> <span class="op">=</span> <span class="op">[</span><span class="dv">151358</span><span class="op">,</span> <span class="dv">151371</span><span class="op">,</span> <span class="dv">151309</span><span class="op">]</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co"># input files</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="dt">forcing</span> <span class="op">=</span> <span class="st">"../data/input/6/forcing.arrow"</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="dt">state</span> <span class="op">=</span> <span class="st">"../data/input/6/state.arrow"</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="op">=</span> <span class="st">"../data/input/6/static.arrow"</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="dt">profile</span> <span class="op">=</span> <span class="st">"../data/input/6/profile.arrow"</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="dt">network_path</span> <span class="op">=</span> <span class="st">"../data/input/6/network.ply"</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co"># output file</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="dt">waterbalance</span> <span class="op">=</span> <span class="st">"../data/output/waterbalance.arrow"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Additionally, if <code>run_modflow = true</code>, a Modflow specific section needs to be added to the configuration file. This part is documented in <a href="#coupling-demo.qmd">the Modflow coupling demo</a>.</p>
</section>
<section id="network" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="network"><span class="header-section-number">3.3.2</span> Network</h3>
<p>The network, as set with <code>network_path</code> in the configuration file, is the path to a <a href="https://en.wikipedia.org/wiki/PLY_(file_format)">PLY file</a>. This network is a directed graph, that links the different basins to each other, as described in <a href="#sec-space">Section&nbsp;2.3</a>.</p>
<p>The PLY format is a relatively simple file format that comes in binary and ASCII flavors, both of which are supported. To support viewing the network as a mesh layer in <a href="https://docs.qgis.org/latest/en/docs/user_manual/working_with_mesh/mesh_properties.html">QGIS</a>, we recommend adding a comment specifying the coordinate reference system (CRS) as documented by <a href="https://www.mdal.xyz/drivers/ply.html">MDAL</a> and shown below. In this example, only the first and last two vertices are shown, just like for the edges.</p>
<pre><code>ply
format ascii 1.0
comment crs: EPSG:28992
element vertex 8531
property float64 x
property float64 y
property float64 location
element edge 6318
property int32 vertex1
property int32 vertex2
property float32 fractions
end_header
140702.897 414305.632 10020.0
157416.633 424082.847 10037.0
⋮
47343.505 371868.984 991896.0
45651.526 372390.837 991908.0
0 11 1.0
1 25 1.0
⋮
8512 7572 1.0
8516 7677 1.0</code></pre>
<p>For each vertex, the x and y coordinates are given, followed by the location ID. For each edge, the source and destination vertex are given, followed by the fraction. The vertex here refers not to the location ID, but to the zero-based index of the vertices as ordered in the file. The fraction is typically 1.0, but can be divided into smaller parts if there is a bifurcation from one basin to two downstream basins. This then represents the fraction of water flowing from the source along this edge.</p>
<p>The network file is allowed to be a superset of the locations IDs that you simulate (the <code>lsw_ids</code> configuration). A sub-network will be derived automatically.</p>
</section>
<section id="arrow-files" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="arrow-files"><span class="header-section-number">3.3.3</span> Arrow files</h3>
<p>The input and output files described below all share that they are tabular files, stored in the <a href="https://arrow.apache.org/">Apache Arrow</a> IPC file format, also known as Feather files. This format has been chosen since it is standardized, fast, simple and flexible. It can be read and written by many different software packages and libraries in different languages. In Bach we use <a href="https://arrow.juliadata.org/dev/">Arrow.jl</a>.</p>
<p>Below we give details per file, in which we describe the schema of the table using a syntax like this:</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>location</td>
<td>Int</td>
<td>-</td>
</tr>
<tr class="even">
<td>volume</td>
<td>Float64</td>
<td>non-negative</td>
</tr>
</tbody>
</table>
<p>This means that two columns are required, one named <code>location</code>, that contained elements of type <code>Int</code>, and a column named <code>volume</code> that contains elements of type <code>Float64</code>. The order of the columns does not matter, and the files are also allowed to have extra columns, which will be ignored. In some cases there may be restrictions on the values or the ordering of the rows. This is indicated under <code>restriction</code>.</p>
<p>Tables are also allowed to have rows for locations, variables or times that are not part of the simulation, these will be ignored. That makes it easy to prepare data for a larger region once, and test models on a subset of the basins.</p>
<p>The Arrow input files can be compressed with LZ4 or Zstd compression. Furthermore, in some of the columns, a small amount of different values are repeated many times. To reduce file sizes it may be a good idea to apply <a href="https://arrow.apache.org/docs/format/Columnar.html#dictionary-encoded-layout">dictionary encoding</a> to those columns.</p>
</section>
<section id="state" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="state"><span class="header-section-number">3.3.4</span> State</h3>
<p>The state table aims to capture the full state of the system, such that it can be used as an initial condition, that is potentially the outcome of an earlier simulation. Currently the only state is the volume of storage.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>location</td>
<td>Int</td>
<td>-</td>
</tr>
<tr class="even">
<td>volume</td>
<td>Float64</td>
<td>non-negative</td>
</tr>
</tbody>
</table>
<p>Each location specified in <code>lsw_ids</code> needs to be in the table.</p>
</section>
<section id="static" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="static"><span class="header-section-number">3.3.5</span> Static</h3>
<p>The static table provides data that is fixed per location. The <code>local_surface_water_type</code> can be either <code>V</code> for free draining basins or <code>P</code> for level controlled basins.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>location</td>
<td>Int</td>
<td>-</td>
</tr>
<tr class="even">
<td>target_level</td>
<td>Float64</td>
<td>-</td>
</tr>
<tr class="odd">
<td>target_volume</td>
<td>Float64</td>
<td>-</td>
</tr>
<tr class="even">
<td>local_surface_water_type</td>
<td>Char</td>
<td>‘V’ or ‘P’</td>
</tr>
</tbody>
</table>
<p>Each location specified in <code>lsw_ids</code> needs to be in the table.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Of <code>target_level</code> and <code>target_volume</code>, currently only <code>target_volume</code> is used, and only for level controlled basins. This variable should be moved to the forcing table to allow dynamic targets.</p>
</div>
</div>
</section>
<section id="profile" class="level3" data-number="3.3.6">
<h3 data-number="3.3.6" class="anchored" data-anchor-id="profile"><span class="header-section-number">3.3.6</span> Profile</h3>
<p>The profile table defines the physical dimensions of the storage reservoir of each basin. Depending on the basin type, the columns are used differently. For free draining basins, the level is not used in the calculation, but may be used to convert calculated volumes to levels for output. For level controlled basins, the discharge is not used.</p>
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 17%">
<col style="width: 30%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>location</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>volume</td>
<td>Float64</td>
<td><span class="math inline">\(m^3\)</span></td>
<td>sorted per location and start at 0</td>
</tr>
<tr class="odd">
<td>area</td>
<td>Float64</td>
<td><span class="math inline">\(m^2\)</span></td>
<td>sorted per location and non-negative</td>
</tr>
<tr class="even">
<td>discharge</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>sorted per location and non-negative</td>
</tr>
<tr class="odd">
<td>level</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>sorted per location</td>
</tr>
</tbody>
</table>
<p>The level is in meters above a datum that is the same for the entire model. An example of the first 5 rows of such a table is given below. The first 4 rows define the profile of location <code>10020</code>. The number of rows can vary per location. Using a very large number of rows may impact performance.</p>
<table class="table">
<thead>
<tr class="header">
<th>location</th>
<th>volume</th>
<th>area</th>
<th>discharge</th>
<th>level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10020</td>
<td>0.0</td>
<td>1.36404e5</td>
<td>0.0</td>
<td>-0.105</td>
</tr>
<tr class="even">
<td>10020</td>
<td>24726.2</td>
<td>1.36404e5</td>
<td>0.0</td>
<td>0.095</td>
</tr>
<tr class="odd">
<td>10020</td>
<td>49452.5</td>
<td>1.36404e5</td>
<td>0.00942702</td>
<td>0.295</td>
</tr>
<tr class="even">
<td>10020</td>
<td>2.49735e6</td>
<td>1.36404e5</td>
<td>0.942702</td>
<td>20.095</td>
</tr>
<tr class="odd">
<td>10037</td>
<td>0.0</td>
<td>50663.3</td>
<td>0.0</td>
<td>2.129</td>
</tr>
</tbody>
</table>
<p>Each location specified in <code>lsw_ids</code> needs to be in the table at least once.</p>
</section>
<section id="forcing" class="level3" data-number="3.3.7">
<h3 data-number="3.3.7" class="anchored" data-anchor-id="forcing"><span class="header-section-number">3.3.7</span> Forcing</h3>
<p>All dynamic data can be added to the forcing table.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>DateTime</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>variable</td>
<td>String</td>
<td>-</td>
</tr>
<tr class="odd">
<td>location</td>
<td>Int</td>
<td>-</td>
</tr>
<tr class="even">
<td>value</td>
<td>Float64</td>
<td>depending on variable</td>
</tr>
</tbody>
</table>
<p>Here is an example of the first and last two rows of a forcing table:</p>
<table class="table">
<thead>
<tr class="header">
<th>time</th>
<th>variable</th>
<th>location</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2019-01-01T00:00:00</td>
<td>precipitation</td>
<td>150006</td>
<td>2.89352e-10</td>
</tr>
<tr class="even">
<td>2019-01-01T00:00:00</td>
<td>precipitation</td>
<td>150016</td>
<td>2.89352e-10</td>
</tr>
<tr class="odd">
<td>⋮</td>
<td>⋮</td>
<td>⋮</td>
<td>⋮</td>
</tr>
<tr class="even">
<td>2020-12-31T00:00:00</td>
<td>evaporation</td>
<td>151690</td>
<td>1.15741e-9</td>
</tr>
<tr class="odd">
<td>2020-12-31T00:00:00</td>
<td>evaporation</td>
<td>151707</td>
<td>1.15741e-9</td>
</tr>
</tbody>
</table>
<p>The forcing table is a <a href="https://en.wikipedia.org/wiki/Wide_and_narrow_data#Narrow">narrow table</a>. When the simulation arrives at a time given in the forcing data, it will update all the values given for that time. These values then stay constant until the next update, there is no interpolation in between. This format give maximum flexibility to update different variables at different times.</p>
</section>
<section id="water-balance" class="level3" data-number="3.3.8">
<h3 data-number="3.3.8" class="anchored" data-anchor-id="water-balance"><span class="header-section-number">3.3.8</span> Water balance</h3>
<p>The water balance table outputs all water balance terms at a regular output frequency, as defined by <code>output_timestep</code> in the configuration file. The units are <span class="math inline">\(m^3\)</span>, which is the total volume of flow into the basin since the previous output timestep. The inital timestep of the simulation, with all values set to zero, is also written to the file. Since flow out of the basin is given a negative value, and the storage change is included, you can sum all components to verify the closure of the water balance.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>DateTime</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>variable</td>
<td>String</td>
<td>-</td>
</tr>
<tr class="odd">
<td>location</td>
<td>Int</td>
<td>-</td>
</tr>
<tr class="even">
<td>value</td>
<td>Float64</td>
<td>non-negative volume (<span class="math inline">\(m^3\)</span>)</td>
</tr>
</tbody>
</table>
<p>The water balance table has the same schema as the forcing table. Since the output frequency is constant, and equal for all variables, you can pivot this table from <a href="https://en.wikipedia.org/wiki/Wide_and_narrow_data">narrow</a> to wide data to get the different water balance components as columns. Having them as a narrow table can make it easier to process, since for a given model you may not know the water balance components ahead of time.</p>



</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-pdoktopnl" class="csl-entry" role="doc-biblioentry">
PDOK. 2022. <span>“Dataset: Basisregistratie Topografie (BRT) TOPNL.”</span> <a href="https://www.pdok.nl/downloads/-/article/basisregistratie-topografie-brt-topnl">https://www.pdok.nl/downloads/-/article/basisregistratie-topografie-brt-topnl</a>.
</div>
<div id="ref-REGGIANI1998367" class="csl-entry" role="doc-biblioentry">
Reggiani, Paolo, Murugesu Sivapalan, and S. Majid Hassanizadeh. 1998. <span>“A Unifying Framework for Watershed Thermodynamics: Balance Equations for Mass, Momentum, Energy and Entropy, and the Second Law of Thermodynamics.”</span> <em>Advances in Water Resources</em> 22 (4): 367–98. https://doi.org/<a href="https://doi.org/10.1016/S0309-1708(98)00012-8">https://doi.org/10.1016/S0309-1708(98)00012-8</a>.
</div>
<div id="ref-enwiki:1099736933" class="csl-entry" role="doc-biblioentry">
Wikipedia contributors. 2022. <span>“Drainage Basin — <span>Wikipedia</span><span>,</span> the Free Encyclopedia.”</span> <a href="https://en.wikipedia.org/w/index.php?title=Drainage_basin&amp;oldid=1099736933">https://en.wikipedia.org/w/index.php?title=Drainage_basin&amp;oldid=1099736933</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>