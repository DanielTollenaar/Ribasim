<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Ribasim - Usage</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../core/validation.html" rel="next">
<link href="../core/index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../assets/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="https://user-images.githubusercontent.com/4471859/224825908-bee7e044-bc6b-4561-8b08-5d330cce3ed5.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Ribasim</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../core/index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Julia core</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../python/index.html" rel="" target="">
 <span class="menu-text">Python tooling</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../qgis/index.html" rel="" target="">
 <span class="menu-text">QGIS plugin</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../couple/index.html" rel="" target="">
 <span class="menu-text">Coupled models</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../contribute/index.html" rel="" target="">
 <span class="menu-text">Contributing</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Deltares/Ribasim" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../core/usage.html">Usage</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../core/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Julia core</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../core/usage.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Usage</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../core/validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Validation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../core/equations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Equations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../core/allocation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Allocation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../core/numerics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Numerical considerations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../build/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">API Reference</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#configuration-file" id="toc-configuration-file" class="nav-link active" data-scroll-target="#configuration-file"><span class="header-section-number">1</span> Configuration file</a>
  <ul class="collapse">
  <li><a href="#sec-solver-settings" id="toc-sec-solver-settings" class="nav-link" data-scroll-target="#sec-solver-settings"><span class="header-section-number">1.1</span> Solver settings</a></li>
  <li><a href="#allocation-settings" id="toc-allocation-settings" class="nav-link" data-scroll-target="#allocation-settings"><span class="header-section-number">1.2</span> Allocation settings</a></li>
  <li><a href="#results-settings" id="toc-results-settings" class="nav-link" data-scroll-target="#results-settings"><span class="header-section-number">1.3</span> Results settings</a></li>
  <li><a href="#logging-settings" id="toc-logging-settings" class="nav-link" data-scroll-target="#logging-settings"><span class="header-section-number">1.4</span> Logging settings</a></li>
  </ul></li>
  <li><a href="#geopackage-database-and-arrow-tables" id="toc-geopackage-database-and-arrow-tables" class="nav-link" data-scroll-target="#geopackage-database-and-arrow-tables"><span class="header-section-number">2</span> GeoPackage database and Arrow tables</a>
  <ul class="collapse">
  <li><a href="#table-requirements" id="toc-table-requirements" class="nav-link" data-scroll-target="#table-requirements"><span class="header-section-number">2.1</span> Table requirements</a></li>
  <li><a href="#custom-metadata" id="toc-custom-metadata" class="nav-link" data-scroll-target="#custom-metadata"><span class="header-section-number">2.2</span> Custom metadata</a></li>
  </ul></li>
  <li><a href="#node" id="toc-node" class="nav-link" data-scroll-target="#node"><span class="header-section-number">3</span> Node</a></li>
  <li><a href="#edge" id="toc-edge" class="nav-link" data-scroll-target="#edge"><span class="header-section-number">4</span> Edge</a></li>
  <li><a href="#basin" id="toc-basin" class="nav-link" data-scroll-target="#basin"><span class="header-section-number">5</span> Basin</a>
  <ul class="collapse">
  <li><a href="#basin-time" id="toc-basin-time" class="nav-link" data-scroll-target="#basin-time"><span class="header-section-number">5.1</span> Basin / time</a></li>
  <li><a href="#basin-state" id="toc-basin-state" class="nav-link" data-scroll-target="#basin-state"><span class="header-section-number">5.2</span> Basin / state</a></li>
  <li><a href="#basin-profile" id="toc-basin-profile" class="nav-link" data-scroll-target="#basin-profile"><span class="header-section-number">5.3</span> Basin / profile</a></li>
  <li><a href="#basin-subgrid" id="toc-basin-subgrid" class="nav-link" data-scroll-target="#basin-subgrid"><span class="header-section-number">5.4</span> Basin / subgrid</a></li>
  <li><a href="#basin-results" id="toc-basin-results" class="nav-link" data-scroll-target="#basin-results"><span class="header-section-number">5.5</span> Basin results</a></li>
  <li><a href="#flow-results" id="toc-flow-results" class="nav-link" data-scroll-target="#flow-results"><span class="header-section-number">5.6</span> Flow results</a></li>
  </ul></li>
  <li><a href="#fractionalflow" id="toc-fractionalflow" class="nav-link" data-scroll-target="#fractionalflow"><span class="header-section-number">6</span> FractionalFlow</a></li>
  <li><a href="#tabulatedratingcurve" id="toc-tabulatedratingcurve" class="nav-link" data-scroll-target="#tabulatedratingcurve"><span class="header-section-number">7</span> TabulatedRatingCurve</a>
  <ul class="collapse">
  <li><a href="#tabulatedratingcurve-time" id="toc-tabulatedratingcurve-time" class="nav-link" data-scroll-target="#tabulatedratingcurve-time"><span class="header-section-number">7.1</span> TabulatedRatingCurve / time</a></li>
  </ul></li>
  <li><a href="#pump" id="toc-pump" class="nav-link" data-scroll-target="#pump"><span class="header-section-number">8</span> Pump</a></li>
  <li><a href="#outlet" id="toc-outlet" class="nav-link" data-scroll-target="#outlet"><span class="header-section-number">9</span> Outlet</a></li>
  <li><a href="#user" id="toc-user" class="nav-link" data-scroll-target="#user"><span class="header-section-number">10</span> User</a>
  <ul class="collapse">
  <li><a href="#user-time" id="toc-user-time" class="nav-link" data-scroll-target="#user-time"><span class="header-section-number">10.1</span> User / time</a></li>
  <li><a href="#allocation-results" id="toc-allocation-results" class="nav-link" data-scroll-target="#allocation-results"><span class="header-section-number">10.2</span> Allocation results</a></li>
  </ul></li>
  <li><a href="#levelboundary" id="toc-levelboundary" class="nav-link" data-scroll-target="#levelboundary"><span class="header-section-number">11</span> LevelBoundary</a>
  <ul class="collapse">
  <li><a href="#levelboundary-time" id="toc-levelboundary-time" class="nav-link" data-scroll-target="#levelboundary-time"><span class="header-section-number">11.1</span> LevelBoundary / time</a></li>
  </ul></li>
  <li><a href="#flowboundary" id="toc-flowboundary" class="nav-link" data-scroll-target="#flowboundary"><span class="header-section-number">12</span> FlowBoundary</a>
  <ul class="collapse">
  <li><a href="#flowboundary-time" id="toc-flowboundary-time" class="nav-link" data-scroll-target="#flowboundary-time"><span class="header-section-number">12.1</span> FlowBoundary / time</a></li>
  </ul></li>
  <li><a href="#linearresistance" id="toc-linearresistance" class="nav-link" data-scroll-target="#linearresistance"><span class="header-section-number">13</span> LinearResistance</a></li>
  <li><a href="#manningresistance" id="toc-manningresistance" class="nav-link" data-scroll-target="#manningresistance"><span class="header-section-number">14</span> ManningResistance</a></li>
  <li><a href="#terminal" id="toc-terminal" class="nav-link" data-scroll-target="#terminal"><span class="header-section-number">15</span> Terminal</a></li>
  <li><a href="#discetecontrol" id="toc-discetecontrol" class="nav-link" data-scroll-target="#discetecontrol"><span class="header-section-number">16</span> DisceteControl</a>
  <ul class="collapse">
  <li><a href="#sec-condition" id="toc-sec-condition" class="nav-link" data-scroll-target="#sec-condition"><span class="header-section-number">16.1</span> DiscreteControl / condition</a></li>
  <li><a href="#discretecontrol-logic" id="toc-discretecontrol-logic" class="nav-link" data-scroll-target="#discretecontrol-logic"><span class="header-section-number">16.2</span> DiscreteControl / logic</a></li>
  <li><a href="#discretecontrol-results" id="toc-discretecontrol-results" class="nav-link" data-scroll-target="#discretecontrol-results"><span class="header-section-number">16.3</span> DiscreteControl results</a></li>
  </ul></li>
  <li><a href="#pidcontrol" id="toc-pidcontrol" class="nav-link" data-scroll-target="#pidcontrol"><span class="header-section-number">17</span> PidControl</a>
  <ul class="collapse">
  <li><a href="#pidcontrol-time" id="toc-pidcontrol-time" class="nav-link" data-scroll-target="#pidcontrol-time"><span class="header-section-number">17.1</span> PidControl / time</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Usage</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Ribasim is typically used as a command-line interface (CLI). It is distributed as a <code>.zip</code> archive, that must be downloaded and unpacked. It can be placed anywhere, however it is important that the contents of the zip file are kept together in a directory. The Ribasim CLI executable is in the <code>bin</code> directory.</p>
<p>To download <code>ribasim_cli.zip</code>, see the <a href="../index.html#sec-download">download section</a>.</p>
<p>To check whether the installation was performed successfully, run <code>ribasim</code> with no arguments in the command line. This will give the following message:</p>
<pre><code>Usage: ribasim 'path/to/model/ribasim.toml'</code></pre>
<section id="configuration-file" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Configuration file</h1>
<p>Ribasim has a single configuration file, which is written in the <a href="https://toml.io/">TOML</a> format. It contains settings, as well as paths to other input and output files.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start- and endtime of the simulation</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># can also be set to a date-time like 1979-05-27T07:32:00</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="dt">starttime</span> <span class="op">=</span> <span class="bn">2019-01-01</span> <span class="co"># required</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dt">endtime</span> <span class="op">=</span> <span class="bn">2021-01-01</span>   <span class="co"># required</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># input files</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="dt">input_dir</span> <span class="op">=</span> <span class="st">"."</span>         <span class="co"># required</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="dt">results_dir</span> <span class="op">=</span> <span class="st">"results"</span> <span class="co"># required</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Specific tables can also go into Arrow files rather than the database.</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># For large tables this can benefit from better compressed file sizes.</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># This is optional, tables are retrieved from the database if not specified in the TOML.</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">basin</span><span class="kw">]</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="dt">time</span> <span class="op">=</span> <span class="st">"basin/time.arrow"</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">allocation</span><span class="kw">]</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="dt">timestep</span> <span class="op">=</span> <span class="dv">86400</span>                   <span class="co"># optional (required if use_allocation = true), default 86400</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="dt">use_allocation</span> <span class="op">=</span> <span class="cn">false</span>             <span class="co"># optional, default false</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="dt">objective_type</span> <span class="op">=</span> <span class="st">"linear_absolute"</span> <span class="co"># optional, default "linear_absolute"</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">solver</span><span class="kw">]</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="dt">algorithm</span> <span class="op">=</span> <span class="st">"QNDF"</span>  <span class="co"># optional, default "QNDF"</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="dt">saveat</span> <span class="op">=</span> <span class="op">[]</span>         <span class="co"># optional, default [], which saves every timestep</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="dt">adaptive</span> <span class="op">=</span> <span class="cn">true</span>     <span class="co"># optional, default true</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="dt">dt</span> <span class="op">=</span> <span class="fl">0.0</span>            <span class="co"># optional when adaptive = true, default automatically determined</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="dt">dtmin</span> <span class="op">=</span> <span class="fl">0.0</span>         <span class="co"># optional, default 0.0</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="dt">dtmax</span> <span class="op">=</span> <span class="fl">0.0</span>         <span class="co"># optional, default length of simulation</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="dt">force_dtmin</span> <span class="op">=</span> <span class="cn">false</span> <span class="co"># optional, default false</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="dt">abstol</span> <span class="op">=</span> <span class="fl">1e-6</span>       <span class="co"># optional, default 1e-6</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="dt">reltol</span> <span class="op">=</span> <span class="fl">1e-5</span>       <span class="co"># optional, default 1e-5</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="dt">maxiters</span> <span class="op">=</span> <span class="fl">1e9</span>      <span class="co"># optional, default 1e9</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="dt">sparse</span> <span class="op">=</span> <span class="cn">true</span>       <span class="co"># optional, default true</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="dt">autodiff</span> <span class="op">=</span> <span class="cn">true</span>     <span class="co"># optional, default true</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">logging</span><span class="kw">]</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co"># defines the logging level of Ribasim</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="dt">verbosity</span> <span class="op">=</span> <span class="st">"info"</span> <span class="co"># optional, default "info", can otherwise be "debug", "warn" or "error"</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="dt">timing</span> <span class="op">=</span> <span class="cn">false</span>     <span class="co"># optional, whether to log debug timing statements</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">results</span><span class="kw">]</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="co"># These results files are always written</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="dt">compression</span> <span class="op">=</span> <span class="st">"zstd"</span>  <span class="co"># optional, default "zstd", also supports "lz4"</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="dt">compression_level</span> <span class="op">=</span> <span class="dv">6</span> <span class="co"># optional, default 6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="sec-solver-settings" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="sec-solver-settings"><span class="header-section-number">1.1</span> Solver settings</h2>
<p>The solver section in the configuration file is entirely optional, since we aim to use defaults that will generally work well. Common reasons to modify the solver settings are to adjust the calculation or result stepsizes: <code>adaptive</code>, <code>dt</code>, and <code>saveat</code>. If your model does not converge, or your performance is lower than expected, it can help to adjust other solver settings as well.</p>
<p>The default solver <code>algorithm = "QNDF"</code>, which is a multistep method similar to Matlab’s <code>ode15s</code> <span class="citation" data-cites="shampine1997matlab">(<a href="#ref-shampine1997matlab" role="doc-biblioref">Shampine and Reichelt 1997</a>)</span>. It is an implicit method that supports the default <code>adaptive = true</code> timestepping. The full list of available solvers is: <code>QNDF</code>, <code>Rosenbrock23</code>, <code>TRBDF2</code>, <code>Rodas5</code>, <code>KenCarp4</code>, <code>Tsit5</code>, <code>RK4</code>, <code>ImplicitEuler</code>, <code>Euler</code>. Information on the solver algorithms can be found on the <a href="https://docs.sciml.ai/DiffEqDocs/stable/solvers/ode_solve/">ODE solvers page</a>.</p>
<p>The <code>dt</code> controls the stepsize. When <code>adaptive = true</code>, <code>dt</code> only applies to the initial stepsize, and by default it is automatically determined. When <code>adaptive = false</code> a suitable <code>dt</code> must always be provided. The value is in seconds, so <code>dt = 3600.0</code> corresponds to an hourly timestep. When <code>adaptive = true</code>, <code>dtmin</code> and <code>dtmax</code> control the minimum and maximum allowed <code>dt</code>. If a smaller <code>dt</code> than <code>dtmin</code> is needed to meet the set error tolerances, the simulation stops, unless <code>force_dtmin</code> is set to <code>true</code>. <code>force_dtmin</code> is off by default to ensure an accurate solution.</p>
<p>By default the calculation and result stepsize are the same, with <code>saveat = []</code>, which will save every timestep. <code>saveat</code> can be a number, which is the saving interval in seconds, or it can be a list of numbers, which are the times in seconds since start that are saved. For instance, <code>saveat = 86400.0</code> will save results after every day that passed.</p>
<p>The Jacobian matrix provides information about the local sensitivity of the model with respect to changes in the states. For implicit solvers it must be calculated often, which can be expensive to do. There are several methods to do this. By default Ribasim uses a Jacobian derived automatically using <a href="https://juliadiff.org/ForwardDiff.jl/stable/">ForwardDiff.jl</a> with memory management provided by <a href="https://docs.sciml.ai/PreallocationTools/stable/">PreallocationTools.jl</a>. If this is not used by setting <code>autodiff = false</code>, the Jacobian is calculated with a finite difference method, which can be less accurate and more expensive.</p>
<p>By default the Jacobian matrix is a sparse matrix (<code>sparse = true</code>). Since each state typically only depends on a small number of other states, this is generally more efficient, especially for larger models. The sparsity structure is calculated from the network and provided as a Jacobian prototype to the solver. For small or highly connected models it could be faster to use a dense Jacobian matrix instead by setting <code>sparse = false</code>.</p>
<p>The total maximum number of iterations <code>maxiters = 1e9</code>, can normally stay as-is unless doing extremely long simulations.</p>
<p>The absolute and relative tolerance for adaptive timestepping can be set with <code>abstol</code> and <code>reltol</code>. For more information on these and other solver options, see the <a href="https://docs.sciml.ai/DiffEqDocs/latest/basics/common_solver_opts/#solver_options">DifferentialEquations.jl docs</a>.</p>
</section>
<section id="allocation-settings" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="allocation-settings"><span class="header-section-number">1.2</span> Allocation settings</h2>
<p>Currently there are the following allocation settings: - <code>use_allocation</code>: A boolean which says whether allocation should be used or not; - <code>timestep</code>: a float value in seconds which dictates the update interval for allocations.</p>
</section>
<section id="results-settings" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="results-settings"><span class="header-section-number">1.3</span> Results settings</h2>
<p>The following entries can be set in the configuration in the <code>[results]</code> section.</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 17%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>entry</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>compression</td>
<td>String</td>
<td>Compression algorithm: zstd or lz4.</td>
</tr>
<tr class="even">
<td>compression_level</td>
<td>Int</td>
<td>Compression level. Higher is more compression.</td>
</tr>
<tr class="odd">
<td>subgrid</td>
<td>Bool</td>
<td>Compute and output more detailed water levels.</td>
</tr>
</tbody>
</table>
</section>
<section id="logging-settings" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="logging-settings"><span class="header-section-number">1.4</span> Logging settings</h2>
<p>The following entries can be set in the configuration in the <code>[logging]</code> section.</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 17%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>entry</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>verbosity</td>
<td>String</td>
<td>Verbosity level: debug, info, warn, or error.</td>
</tr>
<tr class="even">
<td>timing</td>
<td>Bool</td>
<td>Enable timings.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="geopackage-database-and-arrow-tables" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> GeoPackage database and Arrow tables</h1>
<p>The input and output tables described below all share that they are tabular files. The Node and Edge tables always have to be in the <a href="https://www.geopackage.org/">GeoPackage</a> database file, and results are always written to <a href="https://arrow.apache.org/">Apache Arrow</a> files, sometimes also known as Feather files. All other tables can either be in the database or in separate Arrow files that are listed in the TOML as described above.</p>
<p>For visualization, the Node and Edge tables typically have associated geometries. GeoPackage was used since it provides a standardized way to store tables with (and without) geometry columns in a SQLite database. If, like Ribasim, you can ignore the geometries, a GeoPackage is easy to read using SQLite libraries, which are commonly available. Furthermore GeoPackage can be updated in place when working on a model.</p>
<p>Arrow was chosen since it is standardized, fast, simple and flexible. It can be read and written by many different software packages. In Ribasim we use <a href="https://arrow.apache.org/julia/dev/">Arrow.jl</a>. Results are written to Arrow, since for long runs Ribasim can produce tables with many rows. Arrow is well suited for large tabular datasets, and file size is kept small by using compression. The Arrow input files can be compressed with LZ4 or Zstd compression. Furthermore, in some of the columns, a small amount of different values are repeated many times. To reduce file sizes it may be a good idea to apply <a href="https://arrow.apache.org/docs/format/Columnar.html#dictionary-encoded-layout">dictionary encoding</a> to those columns.</p>
<section id="table-requirements" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="table-requirements"><span class="header-section-number">2.1</span> Table requirements</h2>
<p>Below we give details per file, in which we describe the schema of the table using a syntax like this:</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>storage</td>
<td>Float64</td>
<td><span class="math inline">\(m^3\)</span></td>
<td>non-negative</td>
</tr>
</tbody>
</table>
<p>This means that two columns are required, one named <code>node_id</code>, that contained elements of type <code>Int</code>, and a column named <code>storage</code> that contains elements of type <code>Float64</code>. The order of the columns does not matter. In some cases there may be restrictions on the values. This is indicated under <code>restriction</code>.</p>
<p>Tables are also allowed to have rows for timestamps that are not part of the simulation, these will be ignored. That makes it easy to prepare data for a larger period, and test models on a shorted period.</p>
<p>When preparing the model for simulation, input validation is performed in the Julia core. The validation rules are described in the <a href="../core/validation.html">validation</a> section.</p>
</section>
<section id="custom-metadata" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="custom-metadata"><span class="header-section-number">2.2</span> Custom metadata</h2>
<p>It may be advantageous to add metadata to rows. For example, basin areas might have names and objects such as weirs might have specific identification codes. Additional columns can be freely added to tables. The column names should be prefixed with <code>meta_</code>. They will not be used in computations or validated by the Julia core.</p>
<p>The ribasim-python library will automatically add the <code>meta_</code> prefix to non-standard columns. Column names already prefixed with <code>meta_</code> will not be updated.</p>
</section>
</section>
<section id="node" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Node</h1>
<p>Node is a table that specifies the ID and type of each node of a model. The ID must be unique among all nodes, and the type must be one of the available node types listed below.</p>
<p>Nodes are components that are connected together to form a larger system. The Basin is a central node type that stores water. The other node types influence the flow between Basins in some way. Counter intuitively, even systems you may think of as edges, such as a canal, are nodes in Ribasim. This is because edges only define direct instantaneous couplings between nodes, and never have storage of their own.</p>
<table class="table">
<colgroup>
<col style="width: 52%">
<col style="width: 20%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>fid</td>
<td>Int</td>
<td>unique, sorted</td>
</tr>
<tr class="even">
<td>type</td>
<td>String</td>
<td>known node type</td>
</tr>
<tr class="odd">
<td>geometry</td>
<td>geoarrow</td>
<td>(optional)</td>
</tr>
<tr class="even">
<td>name</td>
<td>String</td>
<td>(optional, does not have to be unique)</td>
</tr>
<tr class="odd">
<td>allocation_network_id</td>
<td>Int</td>
<td>(optional)</td>
</tr>
</tbody>
</table>
<p>The available node types as of this writing are listed as the top level bullets below. The sub-bullets indicate which tables are associated to the node type. The table name is the name it must have in the database if it is stored there.</p>
<ul>
<li>Basin: stores water
<ul>
<li><code>Basin / static</code>: default forcing values, used if no dynamic data given in the forcing table</li>
<li><code>Basin / profile</code>: geometries of the basins</li>
<li><code>Basin / time</code>: time series of the forcing values</li>
<li><code>Basin / state</code>: used as initial condition of the basins</li>
<li><code>Basin / subgrid</code>: used to interpolate basin levels to a more detailed spatial representation</li>
</ul></li>
<li>FractionalFlow: connect two of these from a Basin to get a fixed ratio bifurcation
<ul>
<li><code>FractionalFlow / static</code>: fractions</li>
</ul></li>
<li>LevelBoundary: stores water at a given level unaffected by flow, like an infinitely large basin
<ul>
<li><code>LevelBoundary / static</code>: levels</li>
<li><code>LevelBoundary / time</code>: dynamic levels</li>
</ul></li>
<li>FlowBoundary: sets a precribed flow into the model
<ul>
<li><code>FlowBoundary / static</code>: flow rate</li>
<li><code>FlowBoundary / time</code>: dynamic flow rate</li>
</ul></li>
<li>LinearResistance: bidirectional flow based on water level difference between Basins
<ul>
<li><code>LinearResistance / static</code>: conductances</li>
</ul></li>
<li>ManningResistance: Flow through this connection is estimated by conservation of energy and the Manning-Gauckler formula to estimate friction losses
<ul>
<li><code>ManningResistance / static</code>: properties</li>
</ul></li>
<li>TabulatedRatingCurve: Basin outflow relation
<ul>
<li><code>TabulatedRatingCurve / static</code>: rating curve</li>
<li><code>TabulatedRatingCurve / time</code>: dynamic rating curve</li>
</ul></li>
<li>Pump: pump water from a source node to a destination node
<ul>
<li><code>Pump / static</code>: flow rate</li>
</ul></li>
<li>Outlet: let water flow with a prescribed flux under the conditions of positive head difference and the upstream level being higher than the minimum crest level
<ul>
<li><code>Outlet / static</code>: flow rate, minimum crest level</li>
</ul></li>
<li>User: sets water usage demands at certain priorities
<ul>
<li><code>User / static</code>: demands</li>
<li><code>User / time</code>: dynamic demands</li>
</ul></li>
<li>Terminal: Water sink without state or properties
<ul>
<li><code>Terminal / static</code>: - (only node IDs)</li>
</ul></li>
<li>DiscreteControl: Set parameters of other nodes based on model state conditions (e.g.&nbsp;basin level)
<ul>
<li><code>DisceteControl / condition</code>: Conditions of the form ‘the level in the basin with node id <code>n</code> is bigger than 2.0 m’</li>
<li><code>DisceteControl / logic</code>: Translates the truth value of a set of conditions to parameter values for a controlled node</li>
</ul></li>
<li>PidControl: Controls the level in a basin by continuously controlling the flow rate of a connected pump or outlet. See also <a href="https://en.wikipedia.org/wiki/PID_controller">Wikipedia</a> and <a href="../core/equations.html#sec-PID">PID controller in equations</a>.
<ul>
<li><code>PidControl / static</code>: The proportional, integral, and derivative parameters, the target value and which basin should be controlled</li>
<li><code>PidControl / time</code>: same as <code>static</code> but varying over time.</li>
</ul></li>
</ul>
<p>Adding a geometry to the node table can be helpful to examine models in <a href="https://qgis.org/en/site/">QGIS</a>, as it will show the location of the nodes on the map. The geometry is not used by Ribasim.</p>
</section>
<section id="edge" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Edge</h1>
<p>Edges define connections between nodes. The only thing that defines an edge is the nodes it connects, and in what direction. There are currently 2 possible edge types:</p>
<ol type="1">
<li>“flow”: Flows between nodes are stored on edges. The effect of the edge direction depends on the node type, Node types that have a notion of an upstream and downstream side use the incoming edge as the upstream side, and the outgoing edge as the downstream side. This means that edges should generally be drawn in the main flow direction. But for instance between two <code>LinearResistances</code> the edge direction does not affect anything, other than the sign of the flow on the edge. The sign of the flow follows the edge direction; a positive flow flows along the edge direction, a negative flow in the opposite way.</li>
<li>“control”: The control edges define which nodes are controlled by a particular control node. Control edges should always point away from the control node. The edges between the control node and the nodes it <em>listens</em> to are <em>not</em> present in <code>Edge \ static</code>, these are defined in <a href="../core/usage.html#sec-condition">Control / condition</a></li>
</ol>
<table class="table">
<colgroup>
<col style="width: 52%">
<col style="width: 20%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>fid</td>
<td>Int</td>
<td>unique, sorted</td>
</tr>
<tr class="even">
<td>from_node_id</td>
<td>Int</td>
<td>-</td>
</tr>
<tr class="odd">
<td>to_node_id</td>
<td>Int</td>
<td>-</td>
</tr>
<tr class="even">
<td>edge_type</td>
<td>String</td>
<td>must be “flow” or “control”</td>
</tr>
<tr class="odd">
<td>geom</td>
<td>geometry</td>
<td>(optional)</td>
</tr>
<tr class="even">
<td>name</td>
<td>String</td>
<td>(optional, does not have to be unique)</td>
</tr>
<tr class="odd">
<td>allocation_network_id</td>
<td>Int</td>
<td>(optional, denotes source in allocation network)</td>
</tr>
</tbody>
</table>
<p>Similarly to the node table, you can use a geometry to visualize the connections between the nodes in QGIS. For instance, you can draw a line connecting the two node coordinates.</p>
</section>
<section id="basin" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Basin</h1>
<p>The Basin table can be used to set the static value of variables. The time table has a similar schema, with the time column added. A static value for a variable is only used if there is no dynamic forcing data for that variable. Specifically, if there is either no time table, it is empty, or all timestamps of that variable are missing.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>precipitation</td>
<td>Float64</td>
<td><span class="math inline">\(m s^{-1}\)</span></td>
<td>non-negative</td>
</tr>
<tr class="odd">
<td>potential_evaporation</td>
<td>Float64</td>
<td><span class="math inline">\(m s^{-1}\)</span></td>
<td>non-negative</td>
</tr>
<tr class="even">
<td>drainage</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>non-negative</td>
</tr>
<tr class="odd">
<td>infiltration</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>non-negative</td>
</tr>
<tr class="even">
<td>urban_runoff</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>non-negative</td>
</tr>
</tbody>
</table>
<p>Note that if variables are not set in the static table, default values are used when possible. These are generally zero, e.g.&nbsp;no precipitation, no inflow. If it is not possible to have a reasonable and safe default, a value must be provided in the static table.</p>
<section id="basin-time" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="basin-time"><span class="header-section-number">5.1</span> Basin / time</h2>
<p>This table is the transient form of the <code>Basin</code> table. The only difference is that a time column is added. The table must by sorted by time, and per time it must be sorted by <code>node_id</code>. A linear interpolation between the given timesteps is currently done if the solver takes timesteps between the given data points. More options will be available later.</p>
</section>
<section id="basin-state" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="basin-state"><span class="header-section-number">5.2</span> Basin / state</h2>
<p>The state table aims to capture the full state of the Basin, such that it can be used as an initial condition, potentially the outcome of an earlier simulation. Currently only the Basin node types have state.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>level</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td><span class="math inline">\(\ge\)</span> basin bottom</td>
</tr>
</tbody>
</table>
<p>Each Basin ID needs to be in the table.</p>
</section>
<section id="basin-profile" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="basin-profile"><span class="header-section-number">5.3</span> Basin / profile</h2>
<p>The profile table defines the physical dimensions of the storage reservoir of each basin.</p>
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 17%">
<col style="width: 30%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>area</td>
<td>Float64</td>
<td><span class="math inline">\(m^2\)</span></td>
<td>non-negative, per node_id: start positive and increasing</td>
</tr>
<tr class="odd">
<td>level</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>per node_id: increasing</td>
</tr>
</tbody>
</table>
<p>The level is the level at the basin outlet. All levels are defined in meters above a datum that is the same for the entire model. An example of the first 5 rows of such a table is given below. The first 4 rows define the profile of ID <code>2</code>. The number of rows can vary per ID. Using a very large number of rows may impact performance.</p>
<table class="table">
<thead>
<tr class="header">
<th>node_id</th>
<th>area</th>
<th>level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>1.0</td>
<td>6.0</td>
</tr>
<tr class="even">
<td>2</td>
<td>1000.0</td>
<td>7.0</td>
</tr>
<tr class="odd">
<td>2</td>
<td>1000.0</td>
<td>9.0</td>
</tr>
<tr class="even">
<td>3</td>
<td>1.0</td>
<td>2.2</td>
</tr>
</tbody>
</table>
<p>We use the symbol <span class="math inline">\(A\)</span> for area, <span class="math inline">\(h\)</span> for level and <span class="math inline">\(S\)</span> for storage. The profile provides a function <span class="math inline">\(A(h)\)</span> for each basin. Internally this get converted to two functions, <span class="math inline">\(A(S)\)</span> and <span class="math inline">\(h(S)\)</span>, by integrating over the function, setting the storage to zero for the bottom of the profile. The minimum area cannot be zero to avoid numerical issues. The maximum area is used to convert the precipitation flux into an inflow.</p>
</section>
<section id="basin-subgrid" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="basin-subgrid"><span class="header-section-number">5.4</span> Basin / subgrid</h2>
<p>The subgrid_level table defines a piecewise linear interpolation from a basin water level to a subgrid element water level. Many subgrid elements may be associated with a single basin, each with distinct interpolation functions. This functionality can be used to translate a single lumped basin level to a more spatially detailed representation (e.g comparable to the output of a hydrodynamic simulation).</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>subgrid_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>constant per subgrid_id</td>
</tr>
<tr class="odd">
<td>basin_level</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>sorted per subgrid_id</td>
</tr>
<tr class="even">
<td>subgrid_level</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>sorted per subgrid_id</td>
</tr>
</tbody>
</table>
<p>The table below shows example input for two subgrid elements:</p>
<table class="table">
<thead>
<tr class="header">
<th>subgrid_id</th>
<th>node_id</th>
<th>basin_level</th>
<th>subgrid_level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>9</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>1</td>
<td>9</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td>1</td>
<td>9</td>
<td>2.0</td>
<td>2.0</td>
</tr>
<tr class="even">
<td>2</td>
<td>9</td>
<td>0.0</td>
<td>0.5</td>
</tr>
<tr class="odd">
<td>2</td>
<td>9</td>
<td>1.0</td>
<td>1.5</td>
</tr>
<tr class="even">
<td>2</td>
<td>9</td>
<td>2.0</td>
<td>2.5</td>
</tr>
</tbody>
</table>
<p>Both subgrid elements use the water level of the basin with <code>node_id</code> 9 to interpolate to their respective water levels. The first element has a one to one connection with the water level; the second also has a one to one connection, but is offset by half a meter. A basin water level of 0.3 would be translated to a water level of 0.3 for the first subgrid element, and 0.8 for the second. Water levels beyond the last <code>basin_level</code> are linearly extrapolated.</p>
<p>Note that the interpolation to subgrid water level is not constrained by any water balance within Ribasim. Generally, to create physically meaningful subgrid water levels, the subgrid table must be parametrized properly such that the spatially integrated water volume of the subgrid elements agrees with the total storage volume of the basin.</p>
</section>
<section id="basin-results" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="basin-results"><span class="header-section-number">5.5</span> Basin results</h2>
<p>The basin table contains results of the storage and level of each basin at every solver timestep. The initial condition is also written to the file.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>DateTime</td>
<td>-</td>
</tr>
<tr class="even">
<td>node_id</td>
<td>Int</td>
<td>-</td>
</tr>
<tr class="odd">
<td>storage</td>
<td>Float64</td>
<td><span class="math inline">\(m^3\)</span></td>
</tr>
<tr class="even">
<td>level</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
</tr>
</tbody>
</table>
<p>The table is sorted by time, and per time it is sorted by <code>node_id</code>.</p>
</section>
<section id="flow-results" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="flow-results"><span class="header-section-number">5.6</span> Flow results</h2>
<p>The flow table contains results of the flow on every edge in the model, for each solver timestep.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>DateTime</td>
<td>-</td>
</tr>
<tr class="even">
<td>edge_id</td>
<td>Union{Int, Missing}</td>
<td>-</td>
</tr>
<tr class="odd">
<td>from_node_id</td>
<td>Int</td>
<td>-</td>
</tr>
<tr class="even">
<td>to_node_id</td>
<td>Int</td>
<td>-</td>
</tr>
<tr class="odd">
<td>flow</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
</tr>
</tbody>
</table>
<p>The table is sorted by time, and per time the same <code>edge_id</code> order is used, though not sorted. Flows that are added to the model at a node, have a missing <code>edge_id</code>, and identical <code>from_node_id</code> and <code>to_node_id</code>. Flows out of the model always have a negative sign, and additions a positive sign.</p>
</section>
</section>
<section id="fractionalflow" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> FractionalFlow</h1>
<p>Lets a fraction (in [0,1]) of the incoming flow trough.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>control_state</td>
<td>String</td>
<td>-</td>
<td>(optional) sorted per node_id</td>
</tr>
<tr class="odd">
<td>fraction</td>
<td>Float64</td>
<td>-</td>
<td>in the interval [0,1]</td>
</tr>
</tbody>
</table>
</section>
<section id="tabulatedratingcurve" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> TabulatedRatingCurve</h1>
<p>This table is similar in structure to the Basin profile. The TabulatedRatingCurve gives a relation between the storage of a connected Basin (via the outlet level) and its outflow.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>control_state</td>
<td>String</td>
<td>-</td>
<td>(optional) sorted per node_id</td>
</tr>
<tr class="odd">
<td>active</td>
<td>Bool</td>
<td>-</td>
<td>(optional, default true)</td>
</tr>
<tr class="even">
<td>level</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>sorted per control_state</td>
</tr>
<tr class="odd">
<td>discharge</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>non-negative</td>
</tr>
</tbody>
</table>
<table class="table">
<thead>
<tr class="header">
<th>node_id</th>
<th>discharge</th>
<th>level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>0.0</td>
<td>-0.105</td>
</tr>
<tr class="even">
<td>2</td>
<td>0.0</td>
<td>0.095</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.00942702</td>
<td>0.295</td>
</tr>
<tr class="even">
<td>2</td>
<td>0.942702</td>
<td>20.095</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0.0</td>
<td>2.129</td>
</tr>
</tbody>
</table>
<section id="tabulatedratingcurve-time" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="tabulatedratingcurve-time"><span class="header-section-number">7.1</span> TabulatedRatingCurve / time</h2>
<p>This table is the transient form of the <code>TabulatedRatingCurve</code> table. The only difference is that a time column is added. The table must by sorted by time, and per time it must be sorted by <code>node_id</code>. With this the rating curves can be updated over time. Note that a <code>node_id</code> can be either in this table or in the static one, but not both.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>time</td>
<td>DateTime</td>
<td>-</td>
<td>sorted per node_id</td>
</tr>
<tr class="odd">
<td>level</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>-</td>
</tr>
<tr class="even">
<td>discharge</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>non-negative</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="pump" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Pump</h1>
<p>Pump water from a source node to a destination node. The set flow rate will be pumped unless the intake storage is less than <span class="math inline">\(10~m^3\)</span>, in which case the flow rate will be linearly reduced to <span class="math inline">\(0~m^3/s\)</span>. The intake must be either a Basin or LevelBoundary. When PID controlled, the pump must point away from the controlled basin in terms of edges.</p>
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 17%">
<col style="width: 30%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>control_state</td>
<td>String</td>
<td>-</td>
<td>(optional) sorted per node_id</td>
</tr>
<tr class="odd">
<td>active</td>
<td>Bool</td>
<td>-</td>
<td>(optional, default true)</td>
</tr>
<tr class="even">
<td>flow_rate</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>non-negative</td>
</tr>
<tr class="odd">
<td>min_flow_rate</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>(optional, default 0.0)</td>
</tr>
<tr class="even">
<td>max_flow_rate</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>(optional)</td>
</tr>
</tbody>
</table>
</section>
<section id="outlet" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Outlet</h1>
<p>The outlet is very similar to the pump. The outlet has two additional physical constraints: water only flows trough the outlet when the head difference is positive (i.e.&nbsp;water flows down by gravity), and the upstream level must be above the minimum crest level if the upstream level is defined. When PID controlled, the outlet must point towards the controlled basin in terms of edges.</p>
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 17%">
<col style="width: 30%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>control_state</td>
<td>String</td>
<td>-</td>
<td>(optional) sorted per node_id</td>
</tr>
<tr class="odd">
<td>active</td>
<td>Bool</td>
<td>-</td>
<td>(optional, default true)</td>
</tr>
<tr class="even">
<td>flow_rate</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>non-negative</td>
</tr>
<tr class="odd">
<td>min_flow_rate</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>(optional, default 0.0)</td>
</tr>
<tr class="even">
<td>max_flow_rate</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>(optional)</td>
</tr>
<tr class="odd">
<td>min_crest_level</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>(optional)</td>
</tr>
</tbody>
</table>
</section>
<section id="user" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> User</h1>
<p>A user can demand a certain flow from the basin that supplies it, distributed over multiple priorities 1,2,3,… where priority 1 denotes the most important demand. Currently the user attempts to extract the complete demand from the Basin. Only if the Basin is almost empty or reaches the minimum level at which the user can extract water (<code>min_level</code>), will it take less than the demand. In the future water can be allocated to users based on their priority. Users need an outgoing flow edge along which they can send their return flow, this can also be to the same basin from which it extracts water. The amount of return flow is always a fraction of the inflow into the user. The difference is consumed by the user.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>active</td>
<td>Bool</td>
<td>-</td>
<td>(optional, default true)</td>
</tr>
<tr class="odd">
<td>demand</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>-</td>
</tr>
<tr class="even">
<td>return_factor</td>
<td>Float64</td>
<td>-</td>
<td>between [0 - 1]</td>
</tr>
<tr class="odd">
<td>min_level</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>(optional)</td>
</tr>
<tr class="even">
<td>priority</td>
<td>Int</td>
<td>-</td>
<td>sorted per node id</td>
</tr>
</tbody>
</table>
<section id="user-time" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="user-time"><span class="header-section-number">10.1</span> User / time</h2>
<p>This table is the transient form of the <code>User</code> table. The only difference is that a time column is added and activity is assumed to be true. The table must by sorted by time, and per time it must be sorted by <code>node_id</code>. With this the demand can be updated over time. In between the given times the demand is interpolated linearly, and outside the demand is constant given by the nearest time value. Note that a <code>node_id</code> can be either in this table or in the static one, but not both.</p>
<table class="table">
<colgroup>
<col style="width: 29%">
<col style="width: 18%">
<col style="width: 27%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>priority</td>
<td>Int</td>
<td>-</td>
<td>sorted per node id</td>
</tr>
<tr class="odd">
<td>time</td>
<td>DateTime</td>
<td>-</td>
<td>sorted per priority per node id</td>
</tr>
<tr class="even">
<td>demand</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>-</td>
</tr>
<tr class="odd">
<td>return_factor</td>
<td>Float64</td>
<td>-</td>
<td>between [0 - 1]</td>
</tr>
<tr class="even">
<td>min_level</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>(optional)</td>
</tr>
</tbody>
</table>
</section>
<section id="allocation-results" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="allocation-results"><span class="header-section-number">10.2</span> Allocation results</h2>
<p>The allocation table contains a record of allocation results: when it happened, for which user node, in which allocation network, and what the demand, allocated flow and abstracted flow were.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>DateTime</td>
</tr>
<tr class="even">
<td>allocation_network_id</td>
<td>Int</td>
</tr>
<tr class="odd">
<td>user_node_id</td>
<td>Int</td>
</tr>
<tr class="even">
<td>priority</td>
<td>Int</td>
</tr>
<tr class="odd">
<td>demand</td>
<td>Float64</td>
</tr>
<tr class="even">
<td>allocated</td>
<td>Float64</td>
</tr>
<tr class="odd">
<td>abstracted</td>
<td>Float64</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Currently the stored demand and abstraction rate are those at the allocation timepoint (and the abstraction rate is based on the previous allocation optimization). In the future these will be an average over the previous allocation timestep.</p>
</div>
</div>
</section>
</section>
<section id="levelboundary" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> LevelBoundary</h1>
<p>Acts like an infinitely large basin where the level does not change by flow. This can be connected to a basin via a <code>LinearResistance</code>. This boundary node will then exchange water with the basin based on the difference in water level between the two.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>active</td>
<td>Bool</td>
<td>-</td>
<td>(optional, default true)</td>
</tr>
<tr class="odd">
<td>level</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>-</td>
</tr>
</tbody>
</table>
<section id="levelboundary-time" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="levelboundary-time"><span class="header-section-number">11.1</span> LevelBoundary / time</h2>
<p>This table is the transient form of the <code>LevelBoundary</code> table. The only difference is that a time column is added and activity is assumed to be true. The table must by sorted by time, and per time it must be sorted by <code>node_id</code>. With this the levels can be updated over time. In between the given times the level is interpolated linearly, and outside the flow rate is constant given by the nearest time value. Note that a <code>node_id</code> can be either in this table or in the static one, but not both.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>time</td>
<td>DateTime</td>
<td>-</td>
<td>sorted per node_id</td>
</tr>
<tr class="odd">
<td>level</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>-</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="flowboundary" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> FlowBoundary</h1>
<p>Pump water to a destination node. We require that the edge connecting the flow boundary to the Basin should point towards the basin, so that positive flow corresponds to water being added to the model. The set flow rate will be pumped unless the intake storage (for a negative flow rate) is less than <span class="math inline">\(10~m^3\)</span>, in which case the flow rate will be linearly reduced to <span class="math inline">\(0~m^3/s\)</span>. Note that the connected node must always be a Basin.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>active</td>
<td>Bool</td>
<td>-</td>
<td>(optional, default true)</td>
</tr>
<tr class="odd">
<td>flow_rate</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>non-negative</td>
</tr>
</tbody>
</table>
<section id="flowboundary-time" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="flowboundary-time"><span class="header-section-number">12.1</span> FlowBoundary / time</h2>
<p>This table is the transient form of the <code>FlowBoundary</code> table. The only differences are that a time column is added and the nodes are assumed to be active so this column is removed. The table must by sorted by time, and per time it must be sorted by <code>node_id</code>. With this the flow rates can be updated over time. In between the given times the flow rate is interpolated linearly, and outside the flow rate is constant given by the nearest time value. Note that a <code>node_id</code> can be either in this table or in the static one, but not both.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>time</td>
<td>DateTime</td>
<td>-</td>
<td>sorted per node_id</td>
</tr>
<tr class="odd">
<td>flow_rate</td>
<td>Float64</td>
<td><span class="math inline">\(m^3 s^{-1}\)</span></td>
<td>non-negative</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="linearresistance" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> LinearResistance</h1>
<p>Flow proportional to the level difference between the connected basins.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>control_state</td>
<td>String</td>
<td>-</td>
<td>(optional) sorted per node_id</td>
</tr>
<tr class="odd">
<td>active</td>
<td>Bool</td>
<td>-</td>
<td>(optional, default true)</td>
</tr>
<tr class="even">
<td>resistance</td>
<td>Float64</td>
<td><span class="math inline">\(sm^{-2}\)</span></td>
<td>-</td>
</tr>
</tbody>
</table>
</section>
<section id="manningresistance" class="level1" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> ManningResistance</h1>
<p>Flow through this connection is estimated by conservation of energy and the Manning-Gauckler formula to estimate friction losses.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>control_state</td>
<td>String</td>
<td>-</td>
<td>(optional) sorted per node_id</td>
</tr>
<tr class="odd">
<td>active</td>
<td>Bool</td>
<td>-</td>
<td>(optional, default true)</td>
</tr>
<tr class="even">
<td>length</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>positive</td>
</tr>
<tr class="odd">
<td>manning_n</td>
<td>Float64</td>
<td><span class="math inline">\(s m^{-\frac{1}{3}}\)</span></td>
<td>positive</td>
</tr>
<tr class="even">
<td>profile_width</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>positive</td>
</tr>
<tr class="odd">
<td>profile_slope</td>
<td>Float64</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
</section>
<section id="terminal" class="level1" data-number="15">
<h1 data-number="15"><span class="header-section-number">15</span> Terminal</h1>
<p>A terminal is a water sink without state or properties. Any water that flows into a terminal node is removed from the model. No water can come into the model from a terminal node. For example, terminal nodes can be used as a downstream boundary.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
</tbody>
</table>
</section>
<section id="discetecontrol" class="level1" data-number="16">
<h1 data-number="16"><span class="header-section-number">16</span> DisceteControl</h1>
<p>DiscreteControl is implemented based on <a href="https://docs.sciml.ai/DiffEqDocs/stable/features/callback_functions/#VectorContinuousCallback">VectorContinuousCallback</a>.</p>
<section id="sec-condition" class="level2" data-number="16.1">
<h2 data-number="16.1" class="anchored" data-anchor-id="sec-condition"><span class="header-section-number">16.1</span> DiscreteControl / condition</h2>
<p>The condition schema defines conditions of the form ‘the discrete_control node with this node id listens to whether the given variable of the node with the given listen feature id is grater than the given value’. If the condition variable comes from a time-series, a look ahead <span class="math inline">\(\Delta t\)</span> can be supplied.</p>
<table class="table">
<colgroup>
<col style="width: 39%">
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>listen_feature_id</td>
<td>Int</td>
<td>-</td>
<td>sorted per node_id</td>
</tr>
<tr class="odd">
<td>variable</td>
<td>String</td>
<td>-</td>
<td>must be “level” or “flow_rate”, sorted per listen_feature_id</td>
</tr>
<tr class="even">
<td>greater_than</td>
<td>Float64</td>
<td>various</td>
<td>sorted per variable</td>
</tr>
<tr class="odd">
<td>look_ahead</td>
<td>Float64</td>
<td><span class="math inline">\(s\)</span></td>
<td>Only on transient boundary conditions, non-negative (optional, default 0)</td>
</tr>
</tbody>
</table>
</section>
<section id="discretecontrol-logic" class="level2" data-number="16.2">
<h2 data-number="16.2" class="anchored" data-anchor-id="discretecontrol-logic"><span class="header-section-number">16.2</span> DiscreteControl / logic</h2>
<p>The logic schema defines which control states are triggered based on the truth of the conditions a discrete_control node listens to. DiscreteControl is applied in the Julia core as follows:</p>
<ul>
<li>During the simulation it is checked whether the truth of any of the conditions changes.</li>
<li>When a condition changes, the corresponding discrete_control node id is retrieved (node_id in the condition schema above).</li>
<li>The truth value of all the conditions this discrete_control node listens to are retrieved, in the order as they are specified in the condition schema. This is then converted into a string of “T” for true and “F” for false. This string we call the truth state.*</li>
<li>The table below determines for the given discrete_control node ID and truth state what the corresponding control state is.</li>
<li>For all the nodes this discrete_control node affects (as given by the “control” edges in <a href="../core/usage.html#edge">Edges / static</a>), their parameters are set to those parameters in <code>NodeType / static</code> corresponding to the determined control state.</li>
</ul>
<p>*. There is also a second truth state created in which for the last condition that changed it is specified whether it was an upcrossing (“U”) or downcrossing (“D”) of the threshold (greater than) value. If a control state is specified for a truth state that is crossing-specific, this takes precedence over the control state for the truth state that contains only “T” and “F”.</p>
<table class="table">
<colgroup>
<col style="width: 37%">
<col style="width: 21%">
<col style="width: 10%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>control_state</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>truth_state</td>
<td>String</td>
<td>-</td>
<td>Consists of the characters “T” (true), “F” (false), “U” (upcrossing), “D” (downcrossing) and “*” (any), sorted per node_id</td>
</tr>
</tbody>
</table>
</section>
<section id="discretecontrol-results" class="level2" data-number="16.3">
<h2 data-number="16.3" class="anchored" data-anchor-id="discretecontrol-results"><span class="header-section-number">16.3</span> DiscreteControl results</h2>
<p>The control table contains a record of each change of control state: when it happened, which control node was involved, to which control state it changed and based on which truth state.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>DateTime</td>
</tr>
<tr class="even">
<td>control_node_id</td>
<td>Int</td>
</tr>
<tr class="odd">
<td>truth_state</td>
<td>String</td>
</tr>
<tr class="even">
<td>control_state</td>
<td>String</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="pidcontrol" class="level1" data-number="17">
<h1 data-number="17"><span class="header-section-number">17</span> PidControl</h1>
<p>The PidControl node controls the level in a basin by continuously controlling the flow rate of a connected pump or outlet. See also <a href="https://en.wikipedia.org/wiki/PID_controller">PID controller</a>. When A PidControl node is made inactive, the node under its control retains the last flow rate value, and the error integral is reset to 0.</p>
<p>The pump must be an outneighbor of the controlled basin, the outlet must be an inneighbor. Thus for the same coefficient values in <code>proportional</code>, <code>integral</code> and <code>derivative</code>, the pump and outlet have the oppositve effect on the controlled basin.</p>
<p>In the future controlling the flow on a particular edge could be supported.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>control_state</td>
<td>String</td>
<td>-</td>
<td>(optional) sorted per node_id</td>
</tr>
<tr class="odd">
<td>active</td>
<td>Bool</td>
<td>-</td>
<td>(optional, default true)</td>
</tr>
<tr class="even">
<td>listen_node_id</td>
<td>Int</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>target</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>-</td>
</tr>
<tr class="even">
<td>proportional</td>
<td>Float64</td>
<td><span class="math inline">\(s^{-1}\)</span></td>
<td>-</td>
</tr>
<tr class="odd">
<td>integral</td>
<td>Float64</td>
<td><span class="math inline">\(s^{-2}\)</span></td>
<td>-</td>
</tr>
<tr class="even">
<td>derivative</td>
<td>Float64</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
<section id="pidcontrol-time" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="pidcontrol-time"><span class="header-section-number">17.1</span> PidControl / time</h2>
<p>This table is the transient form of the <code>PidControl</code> table. The differences are that a time column is added and the nodes are assumed to be active so this column is removed. The table must by sorted by time, and per time it must be sorted by <code>node_id</code>. With this the target level and PID coefficients can be updated over time. In between the given times the these values interpolated linearly, and outside these values area constant given by the nearest time value. Note that a <code>node_id</code> can be either in this table or in the static one, but not both.</p>
<table class="table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>time</td>
<td>DateTime</td>
<td>-</td>
<td>sorted per node_id</td>
</tr>
<tr class="odd">
<td>listen_node_id</td>
<td>Int</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>target</td>
<td>Float64</td>
<td><span class="math inline">\(m\)</span></td>
<td>-</td>
</tr>
<tr class="odd">
<td>proportional</td>
<td>Float64</td>
<td><span class="math inline">\(s^{-1}\)</span></td>
<td>-</td>
</tr>
<tr class="even">
<td>integral</td>
<td>Float64</td>
<td><span class="math inline">\(s^{-2}\)</span></td>
<td>-</td>
</tr>
<tr class="odd">
<td>derivative</td>
<td>Float64</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-shampine1997matlab" class="csl-entry" role="listitem">
Shampine, Lawrence F, and Mark W Reichelt. 1997. <span>“The Matlab Ode Suite.”</span> <em>SIAM Journal on Scientific Computing</em> 18 (1): 1–22.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../core/index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Julia core</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../core/validation.html" class="pagination-link">
        <span class="nav-page-text">Validation</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>