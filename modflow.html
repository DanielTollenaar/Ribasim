<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.113">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Bach - Modflow</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: 1;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Bach</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./intro.html">Introduction</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./modflow.html" aria-current="page">Modflow</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./user_allocation.html">User Allocation</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./demo.html">Bach Functionality Demonstration</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#modflow-concepts" id="toc-modflow-concepts" class="nav-link active" data-scroll-target="#modflow-concepts">MODFLOW Concepts</a>
  <ul class="collapse">
  <li><a href="#drainage" id="toc-drainage" class="nav-link" data-scroll-target="#drainage">Drainage</a></li>
  <li><a href="#river" id="toc-river" class="nav-link" data-scroll-target="#river">River</a></li>
  <li><a href="#numerical-solution-in-modflow" id="toc-numerical-solution-in-modflow" class="nav-link" data-scroll-target="#numerical-solution-in-modflow">Numerical solution in MODFLOW</a></li>
  <li><a href="#iterative-coupled-solution" id="toc-iterative-coupled-solution" class="nav-link" data-scroll-target="#iterative-coupled-solution">Iterative coupled solution</a>
  <ul class="collapse">
  <li><a href="#drainage-1" id="toc-drainage-1" class="nav-link" data-scroll-target="#drainage-1">Drainage</a></li>
  <li><a href="#river-1" id="toc-river-1" class="nav-link" data-scroll-target="#river-1">River</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#assigning-modflow-water-levels" id="toc-assigning-modflow-water-levels" class="nav-link" data-scroll-target="#assigning-modflow-water-levels">Assigning MODFLOW water levels</a>
  <ul class="collapse">
  <li><a href="#parametrization" id="toc-parametrization" class="nav-link" data-scroll-target="#parametrization">Parametrization</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a></li>
  <li><a href="#test-cases" id="toc-test-cases" class="nav-link" data-scroll-target="#test-cases">Test cases</a></li>
  </ul></li>
  <li><a href="#test-case-hupsel" id="toc-test-case-hupsel" class="nav-link" data-scroll-target="#test-case-hupsel">Test case: Hupsel</a>
  <ul class="collapse">
  <li><a href="#budgets" id="toc-budgets" class="nav-link" data-scroll-target="#budgets">Budgets</a></li>
  <li><a href="#zero-volume" id="toc-zero-volume" class="nav-link" data-scroll-target="#zero-volume">Zero volume</a></li>
  </ul></li>
  <li><a href="#test-case-de-tol" id="toc-test-case-de-tol" class="nav-link" data-scroll-target="#test-case-de-tol">Test case: de Tol</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Modflow</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="modflow-concepts" class="level1">
<h1>MODFLOW Concepts</h1>
<p>Bach has been designed to provide a computationally efficient representation of surface water for MODFLOW6. It does so by connecting to basic MODFLOW6 boundary conditions: the river and drainage packages.</p>
<section id="drainage" class="level2">
<h2 class="anchored" data-anchor-id="drainage">Drainage</h2>
<p>The drainage package can be simulated to agricultural drains, ditches, or draining streams. The amount of water removed from the aquifer is proportional to the difference between the groundwater head and the drainage elevation. Drainage only occurs when the head is larger than the elevation; this boundary condition does not allow infiltration into the groundwater.</p>
<p><span class="math display">\[
Q_{drain} = \left\{
    \begin{array}{ c l }
        C_{drain} (\phi - h_{drain}) &amp; \quad \textrm{if } \phi &gt; h_{drain} \\
        0                            &amp; \quad \textrm{otherwise}
     \end{array}
\right.
\]</span></p>
</section>
<section id="river" class="level2">
<h2 class="anchored" data-anchor-id="river">River</h2>
<p>The river package can both drain the groundwater, or infiltrate surface water to the groundwater. It limits the amount of water that can infiltrate when the groundwater head falls below the river bottom, in which cases it assumes atmospheric pressure conditions underneath the surface water.</p>
<p><span class="math display">\[
Q_{river} = \left\{
    \begin{array}{ c l }
        C_{river} (\phi - h_{river}) &amp; \quad \textrm{if } \phi &gt; b_{river} \\
        C_{river} (h_{river} - b_{river}) &amp; \quad \textrm{if } \phi &lt;= b_{river}
     \end{array}
\right.
\]</span></p>
<p>In the Netherlands, it is somewhat common to make a distinction between the drainage and infiltration conductance of surface waters. Drainage conductance is often larger than the infiltration conductance due to clogging processes, seepage through sides of the ditches, less contracted flow lines, etc.</p>
<p><span class="math display">\[
Q_{river} = \left\{
    \begin{array}{ c l }
        C_{river,drn} (\phi - h_{river}) &amp; \quad \textrm{if } \phi &gt; h_{river} \\
        C_{river,inf} (\phi - h_{river}) &amp; \quad \textrm{if } \phi &lt;= h_{river} \\
        C_{river,inf} (h_{river} - b_{river}) &amp; \quad \textrm{if } \phi &lt;= b_{river}
     \end{array}
\right.
\]</span></p>
<p>MODFLOW6 does not support this (currently), but an identical effect may be achieved by “stacking” a drainage package on top of a river package with these values:</p>
<p><span class="math display">\[
\begin{aligned}
h_{drain} = h_{river}
C_{drain} = C_{river,drn} - C{river,inf}
\end{aligned}
\]</span></p>
</section>
<section id="numerical-solution-in-modflow" class="level2">
<h2 class="anchored" data-anchor-id="numerical-solution-in-modflow">Numerical solution in MODFLOW</h2>
<p>MODFLOW uses a backward-in-time implicit solution scheme. This creates a large system of equations (a water balance for every cell), which it solves by repeatedly solving a linearized system of equations instead. In matrix form, this system of equations is expressed by:</p>
<p><span class="math display">\[
\mathbf{Ax} = \mathbf{b}
\]</span></p>
<p>Where <span class="math inline">\(\mathbf{x}\)</span> is a vector containing the head of every cell.</p>
<p>For the boundary conditions, this requires linearization of the flow equations. Flow from outside of the aquifer (cell) may be represented by:</p>
<p><span class="math display">\[
a = p\phi + q
\]</span></p>
<p>(Equation 2-6 in the MODFLOW6 documentation <span class="citation" data-cites="langevin2017documentation">(<a href="#ref-langevin2017documentation" role="doc-biblioref">Langevin et al. 2017</a>)</span>.)</p>
<p>For e.g.&nbsp;a draining boundary condition, the flow is head dependent:</p>
<p><span class="math display">\[
a = C(h - \phi) = -C\phi + Ch
\]</span></p>
<p>With <span class="math inline">\(C\)</span> the conductance, <span class="math inline">\(h\)</span> the boundary head or elevation, and <span class="math inline">\(\phi\)</span> the groundwater head.</p>
<p>In MODFLOW’s internal formulation, the term in <span class="math inline">\(\mathbf{A}\)</span> is called “coefficient of head” or hcof. Terms in <span class="math inline">\(\mathbf{b}\)</span> are called “right hand side” or rhs. We can separate the equation above:</p>
<p><span class="math display">\[
\begin{aligned}
p = \text{hcof} = -C \\
q = \textrm{rhs} = -Ch \\
a = -C\phi + Ch = \text{hcof} * \phi - \text{rhs}
\end{aligned}
\]</span></p>
<p>For every boundary condition, MODFLOW6 stores the <code>hcof</code> and <code>rhs</code> values. This makes it quite convenient for us to compute the water budget for every boundary condition: we simply multiply the hcof value by the head of the cell and subtract the rhs.</p>
<p>Note that hcof may have a value of 0! For example, when for a river boundary the <span class="math inline">\(\phi &lt;= b_{river}\)</span> condition occurs, the flow into the cell is controlled only by <span class="math inline">\(h_{river}\)</span> and <span class="math inline">\(b_{river}\)</span> (equal to recharge for the linear solution).</p>
</section>
<section id="iterative-coupled-solution" class="level2">
<h2 class="anchored" data-anchor-id="iterative-coupled-solution">Iterative coupled solution</h2>
<p>We can use a linearization to efficiently compute the flow from Bach’s side as well. In the iterative coupled solution, we are solving both MODFLOW6 and Bach repeatedly, until they produce same drainage or infiltration (approximately). One of Bach’s <code>LocalSurfaceWater</code>s contains many MODFLOW cells with boundary conditions. We could add every boundary condition to Bach’s equations, but this is costly and cumbersome.</p>
<p>Linearization allows us to “stack” (superpose) all the different boundary conditions into a single, simple equation. In linear form, every equation takes the form of:</p>
<p><span class="math display">\[
a = ph + q
\]</span></p>
<p>Note the <span class="math inline">\(h\)</span> rather than <span class="math inline">\(\phi\)</span>, we are formulating from Bach’s perspective! We can sum all coefficients for p and q to provide a linear groundwater response to Bach.</p>
<section id="drainage-1" class="level3">
<h3 class="anchored" data-anchor-id="drainage-1">Drainage</h3>
<p>From Bach’s perspective, the groundwater head is constant given a timestep, so that:</p>
<p><span class="math display">\[
\begin{align}
p = -C \\
q = -C\phi
\end{align}
\]</span></p>
<p>When the head falls below the drainage elevation, the coefficients are 0.</p>
</section>
<section id="river-1" class="level3">
<h3 class="anchored" data-anchor-id="river-1">River</h3>
<p>From Bach’s persective, infiltration is never limited when the head falls below the bottom:</p>
<p><span class="math display">\[
\begin{align}
p = -C \\
q = -Cb
\end{align}
\]</span></p>
<p>Otherwise, infiltration and drainage occur with the same equation as for the drainage package:</p>
<p><span class="math display">\[
\begin{align}
p = -C \\
q = -C\phi
\end{align}
\]</span></p>
</section>
</section>
</section>
<section id="assigning-modflow-water-levels" class="level1">
<h1>Assigning MODFLOW water levels</h1>
<p>Principally, MODFLOW deals with water levels; Bach deals with water volumes. The translation from a water volume to a water level should be a relatively straightforward one:</p>
<p><span class="math display">\[
\Delta d = \frac{\Delta V}{A}
\]</span></p>
<p>However, the primary complication is that where Bach has <strong>one</strong> volume, MODFLOW has many levels to adjust. The sum of all these adjustments times their respective areas should result in the LSW volume change:</p>
<p><span class="math display">\[
\sum_{i=0}^{i=n} \Delta d_i A_i = \Delta V_{LSW}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
h = b + d
\]</span></p>
<p>It should be obvious that there are many ways to distribute this volume change across the adjustment of every boundary condition of every cell. The main question is when a volume grows or decreases, how should this volume change be distributed across the LSW?</p>
<p>The best method to find an answer to this question is to run a hydraulic model, extract water heights, and compute the total volume. This can then be used as a lookup table for every cell. These runs can also be used for parametrizing the volume-discharge lookup tables. In coupling to Bach, we need only find the appropriate volume and assign the associated water level. For efficiency, this lookup table can be discretized in a limited number of steps, and in coupling the level will be interpolated.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Great care is required when parametrizing these volume-level relationships. As Bach does not know the properties of the surface water, it can perform very limited validation of the volume-level lookup tables. As the total volume of the LSW is distributed accross <em>all</em> boundary conditions, it should be checked that the change of the water column for every boundary condition matches the total volume change of the LSW.</p>
</div>
</div>
<p>In principle, all (stationary!) hydraulic behavior of the LSW can be described approximately by these lookup tables.</p>
<section id="parametrization" class="level2">
<h2 class="anchored" data-anchor-id="parametrization">Parametrization</h2>
<p>In coupling Bach to MODFLOW6, relations translating the Bach volume must be given for every every cell of every boundary condition.</p>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<p>To get a feeling for the simplifications and the errors of the approximation, let’s consider three oversimplified hydraulic models:</p>
<ol type="1">
<li>The LSW has a single water level.</li>
<li>The LSW has a single water depth.</li>
<li>The LSW has a water depth that linearly decreases with bed elevation.</li>
</ol>
<p>To investigate these cases, we will assume a rectangular profile (constant wetted area). This allows to create plots of cumulative wetted area versus height, so that the area between the water level and the bed elevation equals LSW volume.</p>
</section>
<section id="test-cases" class="level2">
<h2 class="anchored" data-anchor-id="test-cases">Test cases</h2>
<p>In our test cases, we will work with the Dutch national groundwater model (LHM). For testing, we simplify the top boundary conditions to just three surface water “systems”, from large to small:</p>
<ol type="1">
<li>Primary</li>
<li>Secondary</li>
<li>Tertiary</li>
</ol>
<p>(Note: Bach has no knowledge of these systems. Any basin is represented by a single volume.)</p>
<p>These systems are be separated due to their relatively small size in comparison with relatively coarse cells of the groundwater model: most cells in the LHM contain more than one surface water, and are included via representative parameters which take the physical scaling into account.</p>
<p>In case of sufficiently small cell sizes, no overlap occurs and all surface waters can be represented in a single grid.</p>
<p>For the purposes of testing, we have not created empirical volume-level relationships for the surface water of every cell. Instead, we have chosen for an (over)simplified representation over the hydraulic properties, which makes it easy to verify the behavior of Bach and the coupling procedures:</p>
<ol type="1">
<li>Primary, secondary, and tertiary systems have a rectangular profile: the area of the surface water does not change with water level or volume.</li>
<li>Water depth is constant for a system within a basin.</li>
<li>Water depth increases linearly with volume. (This follows from 1.)</li>
<li>Water depth is distributed across the systems in a geometric progression: when the tertiary system contains 0.1 m of water, the secondary system contains 0.2 m, and the primary system contains 0.4 m.</li>
<li>Water depth is 0.0 m for all systems when basin volume is 0.0. (This follows from 4.)</li>
<li>The distribution of water occurs according to the surface water area (width times length) used for the LHM parametrization of river bed conductance.</li>
</ol>
<p>An example of the resulting parameters for a single cell is shown in <a href="#tbl-hupsel-v-h">Table&nbsp;1</a>. The first row shows the water levels when the basin is empty. The level for primary, secondary, and tertiary are equal to the bottom elevation of the surface waters. The second row shows the volume and levels for water depths of 0.4, 0.2, and 0.1 m. The third row shows the volume and levels for a tenfold larger volume. This results in implausible water levels with depths of 4.0, 2.0 and 1.0 m; the water level in the primary system is over two meters higher than in the tertiary system. In reality, the surface waters would overflow and surface ponding would occur; this mechanism is ignored in this case for the sake simplicity.</p>
<div id="tbl-hupsel-v-h" class="anchored">
<table class="table">
<caption>Table&nbsp;1: Volume-level table for a single cell in the Hupsel basin.</caption>
<thead>
<tr class="header">
<th>Volume (m3)</th>
<th>Primary (m NAP)</th>
<th>Secondary (m NAP)</th>
<th>Tertiary (m NAP)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.0</td>
<td>25.65</td>
<td>25.83</td>
<td>26.60</td>
</tr>
<tr class="even">
<td>6843.1</td>
<td>26.05</td>
<td>26.03</td>
<td>26.70</td>
</tr>
<tr class="odd">
<td>68431.0</td>
<td>29.65</td>
<td>27.83</td>
<td>27.60</td>
</tr>
</tbody>
</table>
</div>
<p>Image … shows the volume of the first row of the cell based input for the primary system. Symbology is set to unique values.</p>
</section>
</section>
<section id="test-case-hupsel" class="level1">
<h1>Test case: Hupsel</h1>
<p>To test the coupling, the following simulations have been setup and run:</p>
<ol type="1">
<li>A standalone MODFLOW6 run of sequential steady-states (i.e.&nbsp;no storage) with differing groundwater recharge values.</li>
<li>A coupled run where the MODFLOW6 stages are updated through the</li>
</ol>
<p>From these tests, we expect the following behavior:</p>
<ol type="1">
<li>Drainage terms should remain largely the same when the water level is lowered in a steady-state: the amount of recharge is fixed, and this is locally drained.</li>
<li>In case of negative recharge (evapotranspiration), infiltration occurs in the surface waters. Infiltration should be zero when the basin volume is 0.</li>
</ol>
<p>Figure … shows the water balance of steady-state for submodel of the LHM that has been by selecting the cells belonging to the district containing the Hupsel catch, the Berkel. The Hupsel basin show the expected behavior: in terms of incoming flows, most is precipitation with a minor part lateral inflow from higher areas. In terms of outgoing flows, most of the precipitation ends up in the surface water, primarily in the many ditches of the tertiary system. Only a relatively small part of the water leaves the basin via the groundwater. Interbasin flows through the groundwater form such a minor role, as the aquifer is thin and transmissivity is limited.</p>
<section id="budgets" class="level2">
<h2 class="anchored" data-anchor-id="budgets">Budgets</h2>
<p>Table … shows the budgets computed by MODFLOW6 per primary, secondary, and tertiary system. These are compared to the budget computed by the coupling procedure, which uses equation …</p>
<p>As expected, these numbers match exactly.</p>
</section>
<section id="zero-volume" class="level2">
<h2 class="anchored" data-anchor-id="zero-volume">Zero volume</h2>
</section>
</section>
<section id="test-case-de-tol" class="level1">
<h1>Test case: de Tol</h1>
<p>Figure … shows the water balance of steady-state for a submodel of the LHM for the Polder de Tol and its surroundings. While groundwater recharge is the dominant in going flow, lateral groundwater flow (over the entire depth of the groundwater model) is a sizable inflow for the area; the larger lateral inflow shows that De Tol is a net receiver of groundwater. In contrast to the Hupsel, the tertiary system is almost entirely absent: drainage occurs not through ephemeral tertiary ditches, but by the permanently water-bearing ditches of the primary and secondary system instead.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-langevin2017documentation" class="csl-entry" role="doc-biblioentry">
Langevin, Christian D, Joseph D Hughes, Edward R Banta, Richard G Niswonger, Sorab Panday, and Alden M Provost. 2017. <span>“Documentation for the MODFLOW 6 Groundwater Flow Model.”</span> US Geological Survey.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>