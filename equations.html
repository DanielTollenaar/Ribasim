<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Ribasim - Water balance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="assets/styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="https://user-images.githubusercontent.com/4471859/224825908-bee7e044-bc6b-4561-8b08-5d330cce3ed5.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Ribasim</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./equations.html" aria-current="page">
 <span class="menu-text">Equations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./modflow.html">
 <span class="menu-text">Modflow</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./coupling-demo.html">
 <span class="menu-text">Coupling</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./developer.html">
 <span class="menu-text">Developer</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./python/index.html">
 <span class="menu-text">Python</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Deltares/Ribasim"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#natural-water-balance-terms" id="toc-natural-water-balance-terms" class="nav-link active" data-scroll-target="#natural-water-balance-terms"><span class="toc-section-number">1</span>  Natural water balance terms</a>
  <ul class="collapse">
  <li><a href="#precipitation" id="toc-precipitation" class="nav-link" data-scroll-target="#precipitation"><span class="toc-section-number">1.1</span>  Precipitation</a></li>
  <li><a href="#evaporation" id="toc-evaporation" class="nav-link" data-scroll-target="#evaporation"><span class="toc-section-number">1.2</span>  Evaporation</a></li>
  <li><a href="#infiltration-and-drainage" id="toc-infiltration-and-drainage" class="nav-link" data-scroll-target="#infiltration-and-drainage"><span class="toc-section-number">1.3</span>  Infiltration and Drainage</a></li>
  <li><a href="#upstream-and-downstream-flow" id="toc-upstream-and-downstream-flow" class="nav-link" data-scroll-target="#upstream-and-downstream-flow"><span class="toc-section-number">1.4</span>  Upstream and downstream flow</a>
  <ul class="collapse">
  <li><a href="#outflowtable" id="toc-outflowtable" class="nav-link" data-scroll-target="#outflowtable"><span class="toc-section-number">1.4.1</span>  OutflowTable</a></li>
  <li><a href="#levellink" id="toc-levellink" class="nav-link" data-scroll-target="#levellink"><span class="toc-section-number">1.4.2</span>  LevelLink</a></li>
  <li><a href="#noflowboundary" id="toc-noflowboundary" class="nav-link" data-scroll-target="#noflowboundary"><span class="toc-section-number">1.4.3</span>  NoFlowBoundary</a></li>
  <li><a href="#headboundary" id="toc-headboundary" class="nav-link" data-scroll-target="#headboundary"><span class="toc-section-number">1.4.4</span>  HeadBoundary</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#allocated-water-balance-terms" id="toc-allocated-water-balance-terms" class="nav-link" data-scroll-target="#allocated-water-balance-terms"><span class="toc-section-number">2</span>  Allocated water balance terms</a>
  <ul class="collapse">
  <li><a href="#general-user" id="toc-general-user" class="nav-link" data-scroll-target="#general-user"><span class="toc-section-number">2.1</span>  General User</a></li>
  <li><a href="#level-control" id="toc-level-control" class="nav-link" data-scroll-target="#level-control"><span class="toc-section-number">2.2</span>  Level Control</a></li>
  <li><a href="#flushing" id="toc-flushing" class="nav-link" data-scroll-target="#flushing"><span class="toc-section-number">2.3</span>  Flushing</a></li>
  </ul></li>
  <li><a href="#numerical-solution" id="toc-numerical-solution" class="nav-link" data-scroll-target="#numerical-solution"><span class="toc-section-number">3</span>  Numerical solution</a></li>
  <li><a href="#performance" id="toc-performance" class="nav-link" data-scroll-target="#performance"><span class="toc-section-number">4</span>  Performance</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Water balance</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Ribasim currently simulates the following “natural” water balance terms:</p>
<ol type="1">
<li>Precipitation</li>
<li>Evaporation</li>
<li>Infiltration</li>
<li>Drainage</li>
<li>Urban runoff</li>
<li>Upstream and downstream flow</li>
</ol>
<p>Additionally, Ribasim simulates the following “allocated” water balance terms:</p>
<ol type="1">
<li>General user</li>
<li>Level Control</li>
<li>Flushing</li>
</ol>
<p>Depending on the type of boundary conditions, Ribasim requires relation between storage volume and wetted area (<span class="math inline">\(A\)</span>), and between the storage volume and the water level (<span class="math inline">\(h\)</span>). These are (currently) represented by piecewise linear relationships.</p>
<section id="natural-water-balance-terms" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Natural water balance terms</h1>
<section id="precipitation" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="precipitation"><span class="header-section-number">1.1</span> Precipitation</h2>
<p>The precipitation term is given by:</p>
<p><span class="math display">\[
Q_P = P A(S)
\]</span></p>
<p>Where <span class="math inline">\(P\)</span> is the precipitation rate and <span class="math inline">\(A\)</span> is the wetted area. <span class="math inline">\(A\)</span> is a function of storage: as the volume of water changes, the area of the free water surface may change as well, depending on the slopes of the surface waters.</p>
</section>
<section id="evaporation" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="evaporation"><span class="header-section-number">1.2</span> Evaporation</h2>
<p>The evaporation term is given by:</p>
<p><span class="math display">\[
Q_E = E_{pot} \cdot A(S) \cdot (0.5 \cdot \tanh(S - 50.0) / 10.0) + 0.5
\]</span></p>
<p>Where <span class="math inline">\(E_{pot}\)</span> is the potential evaporation rate and <span class="math inline">\(A\)</span> is the wetted area. The <span class="math inline">\((0.5 \cdot \tanh(S - 50.0) / 10.0) + 0.5\)</span> term ensures no evaporation occurs when <span class="math inline">\(S &lt;= 0\)</span> and is a sigmoid function which provides a smooth gradient as <span class="math inline">\(S \rightarrow 0\)</span>.</p>
<p>A straightforward formulation <span class="math inline">\(Q_E = \mathrm{max}(E_{pot} A(S), 0)\)</span> is unsuitable, as <span class="math inline">\(\frac{\mathrm{d}Q_E}{\mathrm{d}S}(S=0)\)</span> is <span class="math inline">\(\infty\)</span>. A hyperbolic tangent is a commonly used activation function <span class="citation" data-cites="enwiki:1106669904">(<a href="#ref-enwiki:1106669904" role="doc-biblioref">Wikipedia contributors 2022</a>)</span> to approximate on-off behavior while preserving a smooth derivative.</p>
<p>A non-smooth derivative results in extremely small timesteps and long computation time: ModelingToolkit identifies the singular behavior and adjusts it timestepping. In a physical interpretation, evaporation is switched on or off per individual droplet of water. In general, the effect of the sigmoid term is negligible, or not even necessary. As a surface water dries, its wetted area decreases and so does the evaporative flux. However, for (simplified) cases with constant wetted surface (a rectangular profile), evaporation only stops at <span class="math inline">\(S = 0\)</span>.</p>
</section>
<section id="infiltration-and-drainage" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="infiltration-and-drainage"><span class="header-section-number">1.3</span> Infiltration and Drainage</h2>
<p>Infiltration is provided as a lump sum for the basin. If Ribasim is coupled with MODFLOW 6, the infiltration is computed as the sum of all <strong>positive</strong> flows of the MODFLOW 6 boundary conditions in the basin:</p>
<p><span class="math display">\[
Q_{inf} = \sum_{i=1}^{n} \sum_{j=1}^{m} \max(Q_{\mathrm{mf6}_{i,j}}, 0.0)
\]</span></p>
<p>Where <span class="math inline">\(i\)</span> is the index of the boundary condition, <span class="math inline">\(j\)</span> the MODFLOW 6 cell index, <span class="math inline">\(n\)</span> the number of boundary conditions, and <span class="math inline">\(m\)</span> the number of MODFLOW 6 cells in the basin. <span class="math inline">\(Q_{\mathrm{mf6}_{i,j}}\)</span> is the flow computed by MODFLOW 6 for cell <span class="math inline">\(j\)</span> for boundary condition <span class="math inline">\(i\)</span>.</p>
<p>Drainage is a lump sump for the basin, and consists of the sum of the absolute value of all <strong>negative</strong> flows of the MODFLOW 6 boundary conditions in the basin.</p>
<p><span class="math display">\[
Q_{drn} = \sum_{i=1}^{n} \sum_{j=1}^{m} \left| \min(Q_{\mathrm{mf6}_{i,j}}, 0.0) \right|
\]</span></p>
<p>The interaction with MODFLOW 6 boundary conditions is explained in greater detail in the <a href="./coupling-demo.html">the MODFLOW coupling section</a> of this documentation.</p>
</section>
<section id="upstream-and-downstream-flow" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="upstream-and-downstream-flow"><span class="header-section-number">1.4</span> Upstream and downstream flow</h2>
<p>Ribasim’s basins can be connected to each other, and each basin expects an explicit connection. Two connections are currently available for inter-basin flows:</p>
<ol type="1">
<li><code>OutflowTable</code></li>
<li><code>LevelLink</code></li>
</ol>
<p>The flow direction of the basin is not pre-determined: flow directions may freely reverse, provided the connection allows it. Currently, a <code>LevelLink</code> allows bidirectional flow, but the</p>
<p>Additionally, two additional “connections” area available for the “outmost” basins (external nodes) in a network.</p>
<ol type="1">
<li><code>NoFlowBoundary</code></li>
<li><code>HeadBoundary</code></li>
</ol>
<section id="outflowtable" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="outflowtable"><span class="header-section-number">1.4.1</span> OutflowTable</h3>
<p>The OutflowTable is a tabulation of a basin’s discharge behavior. It describes a piecewise linear relationship between the basin’s storage volume and its discharge. It can be understood as an emprical description of a basin’s properties. This can include a weir, but also the lumped hydraulic behavior of the upstream channels.</p>
<p>The OutflowTable should indicate at which volume no discharge occurs (the dead storage volume).</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Currently, the discharge relies only on the basin’s volume; it could also use the volume of both connected basins to simulate backwater effects, submersion of weirs, or even reversal of flows for high precipitation events.</p>
</div>
</div>
</section>
<section id="levellink" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="levellink"><span class="header-section-number">1.4.2</span> LevelLink</h3>
<p>A <code>LevelLink</code> connects two basins together. The flow between the two basins is determined by a linear relationship:</p>
<p><span class="math display">\[
Q = C (h_a - h_b)
\]</span></p>
<p>Where <span class="math inline">\(h_a\)</span> is the water level in the first basin, <span class="math inline">\(h_b\)</span> is the water level in the second basin, and <span class="math inline">\(C\)</span> is the conductance of the link. A <code>LevelLink</code> makes no assumptions about the direction of the flow: water flows from high to low.</p>
</section>
<section id="noflowboundary" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="noflowboundary"><span class="header-section-number">1.4.3</span> NoFlowBoundary</h3>
<p>This sets the exchange flow to 0.</p>
</section>
<section id="headboundary" class="level3" data-number="1.4.4">
<h3 data-number="1.4.4" class="anchored" data-anchor-id="headboundary"><span class="header-section-number">1.4.4</span> HeadBoundary</h3>
<p>This sets the water level in the basin to a fixed level; lower or higher level result in instantaneous corrective fluxes.</p>
</section>
</section>
</section>
<section id="allocated-water-balance-terms" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Allocated water balance terms</h1>
<p>Ribasim has been designed with the functionality to allocate water to different users within each basin. The volume allocated is determined by the user demand, the available water, and the priority of each user with respect to other users within the same basin. The water demands for a given basin can be summarized into three user categories. The handling of the allocation of water for different user categories varies, as explained in more detail below.</p>
<div class="hidden">
<p><span class="math display">\[
\def\qavail{{Q_\mathit{avail\:vol}}}
\def\demwm{{D_{\mathit{wm}}}}
\def\demuser{{D_{\mathit{user}}}}
\]</span></p>
</div>
<section id="general-user" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="general-user"><span class="header-section-number">2.1</span> General User</h2>
<p>The General User category include the users Agriculture, Industry and Public Water supply. These users extract water from the basin and the demand (<span class="math inline">\(\demuser\)</span>) is determined externally. The source of water allocated to the General User is dependent on if the basin is a free-flowing type basin or a level-controlled basin.</p>
<p>If the basin is free-flowing, the water source will be the available water within the basin. If the basin is level-controlled additional water can be sourced from the regional network, should the water available from the basin be insufficient to satisfy <span class="math inline">\(\demuser\)</span>.</p>
<p>The availability of water (<span class="math inline">\(\qavail\)</span>) internally in a basin in a given timestep is calculated by <a href="#eq-q-avail">Equation&nbsp;1</a>. This volume is available to be extracted by the General Users. In the Ribasim prototype, additional water from the regional network is currently modelled as an unlimited supply.</p>
<p><span id="eq-q-avail"><span class="math display">\[
\qavail = \frac{(P - E_{pot}) \cdot \mathit{area}}{\mathrm{Δ}t} - \min(0, Q_{infil} - Q_{drain} - Q_{runoff})
\tag{1}\]</span></span></p>
<p>The <span class="math inline">\(\qavail\)</span> can be assigned to multiple users in the same basin. Allocation is based upon user priority. For a given user, in the case where <span class="math inline">\(\qavail &gt; \demuser\)</span>, the user demand is satisfied and the remaining <span class="math inline">\(\qavail\)</span> becomes available for the user of next highest priority. For a given user, in the case where <span class="math inline">\(\demuser &gt; \qavail\)</span> then all of the available water is assigned to the user. This results in an allocation shortage and no remaining local water for any users of lower priority.</p>
<p>However, as discussed, if the basin is a level-controlled basin, additional water can then be sourced from the regional network and is allocated to satisfy the allocation shortage of the General User.</p>
<p>The allocation of water is decided intermittently by a separate process. This separate process is not all-knowing and it may overextract. Like other water balance sinks, negative storage is avoided and smooth numerical behavior is ensured via an activation function:</p>
<p><span class="math display">\[
Q_{user} = Q_{alloc} \cdot (0.5 \cdot \tanh(S - 50.0) / 10.0) + 0.5
\]</span></p>
</section>
<section id="level-control" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="level-control"><span class="header-section-number">2.2</span> Level Control</h2>
<p>A level-controlled basin (<code>local_surface_water_type = "P"</code>) has a user demand referred to as water management (<span class="math inline">\(\demwm\)</span>). The purpose of this demand is to maintain the water levels for each basin at a target level. This target levels is determined externally. The <span class="math inline">\(\demwm\)</span> is negative if additional water is required to increase the water level in the basin, or positive if there is surplus water which must be removed to lower the level in the basin. When <span class="math inline">\(\demwm\)</span> is positive and there is surplus water, Ribasim is designed to make any surplus water available to General Users within the basin for abstraction. This is modelled by adding the <span class="math inline">\(\demwm\)</span> to the <span class="math inline">\(\qavail\)</span> in calculated in <a href="#eq-wm">Equation&nbsp;2</a>.</p>
<p><span id="eq-wm"><span class="math display">\[
\qavail = \demwm
\tag{2}\]</span></span></p>
<p>When the <span class="math inline">\(\demwm\)</span> is negative, the <span class="math inline">\(\demwm\)</span> is allocated first from the basin <span class="math inline">\(\qavail\)</span>, and then secondly with water from the national network, should the local basin water not be sufficient to satisfy <span class="math inline">\(\demwm\)</span>. This demand is therefore handled similar to that of a General User. In the case that a General User is allocated water as a higher priority than the Level Control such that the water level of the basin decreases, the <span class="math inline">\(\demwm\)</span> will increase accordingly. However, in most cases the demand for Level Control is higher than that of the General Users so this does not occur.</p>
</section>
<section id="flushing" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="flushing"><span class="header-section-number">2.3</span> Flushing</h2>
<p>The flushing requirement for the basin is a special case of user. Flushing is required to maintain water quality in the basin. This is determined externally. Water from the national network flows into the basin, and the same volume gets removed from the basin back to the national network. This water cannot be allocated to other users and there is no net change to the water level in the basin or the <span class="math inline">\(\qavail\)</span>, see <a href="#eq-flushing">Equation&nbsp;3</a>.</p>
<p><span id="eq-flushing"><span class="math display">\[
\mathit{Q_{in}} = -\mathit{Q_{out}}
\tag{3}\]</span></span></p>
</section>
</section>
<section id="numerical-solution" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Numerical solution</h1>
<p>Ribasim uses OrdinaryDiffEq.jl to provide a numerical solution to the water balance equations. Changes to forcings or parameters such as precipitation, but also the allocated water abstraction is managed through the use of CallBack functions <span class="citation" data-cites="callbacks">(<a href="#ref-callbacks" role="doc-biblioref">SciML Development Team 2022</a>)</span>. In a coupled run, the exchanges with MODFLOW 6 are also managed via the use of a callback function.</p>
</section>
<section id="performance" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Performance</h1>
<p>Ribasim needs to be sufficiently fast to make application on the national scale, with ~10000 basins, practical. Therefore, whilst developing, we need to be mindful that our approach can scale to such a size. We currently simulate a set of 40 connected free-flowing basins for a period of 2 years in about 10 seconds.</p>
<p>For a real scaling test we would need to do a national simulation, but we expect these computation times not to be problematic, considering that simulating those same 40 basins in MODFLOW 6 takes minutes.</p>
<p>There are many things that can influence the calculations times, for instance:</p>
<ul>
<li><a href="https://diffeq.sciml.ai/stable/basics/faq/#What-does-tolerance-mean-and-how-much-error-should-I-expect">Solver tolerance</a> we currently use a very conservative tolerance of <code>1e-10</code>, whereas with larger tolerances step sizes can easily be 3x longer, leading to a 3x speedup.</li>
<li><a href="https://diffeq.sciml.ai/stable/solvers/ode_solve/">ODE solvers</a>: The <code>Rosenbrock23</code> method we use is robust to oscillations and massive stiffness, however other solvers should be tried as well.</li>
<li>Forcing: Every time new forcing data is injected into the model, it needs to pause. Moreover, the larger the forcing fluxes are, the bigger the shock to the system, leading to smaller timesteps and thus longer simulation times.</li>
</ul>
<p>Similarly to other models that solve using a system of equations, like MODFLOW 6, if one basin takes longer to converge due to extreme forcing, or bad schematization, the system as a whole need to iterate longer. It is important to be mindful of this, as poor schematization choices can slow down the model.</p>
<p>When scaling up the model, we will need spend some time to strike the right balance between error tolerance, schematization and forcing. The SciML software we use has many <a href="https://sciml.ai/showcase/">showcases</a> of large scale applications, as well as documentation on how to achieve the optimal performance for your system.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-callbacks" class="csl-entry" role="doc-biblioentry">
SciML Development Team. 2022. <span>“Event Handling and Callback Functions.”</span> <a href="https://docs.sciml.ai/DiffEqDocs/latest/features/callback_functions/">https://docs.sciml.ai/DiffEqDocs/latest/features/callback_functions/</a>.
</div>
<div id="ref-enwiki:1106669904" class="csl-entry" role="doc-biblioentry">
Wikipedia contributors. 2022. <span>“Activation Function — <span>Wikipedia</span><span>,</span> the Free Encyclopedia.”</span> <a href="https://en.wikipedia.org/w/index.php?title=Activation_function&amp;oldid=1106669904">https://en.wikipedia.org/w/index.php?title=Activation_function&amp;oldid=1106669904</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>